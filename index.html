<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Haber Robotu – Otomatik Güncel Haberler</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="description" content="Türkiye ve dünyadan en güncel haberler, her saat otomatik yenilenen akışla tek sayfada. Spor, teknoloji, ekonomi, sağlık ve daha fazlası." />
  <meta property="og:title" content="Haber Robotu – Otomatik Güncel Haberler" />
  <meta property="og:description" content="Türkiye ve dünyadan en güncel haberler, her saat otomatik yenilenen akışla tek sayfada." />
  <meta property="og:url" content="https://newest-resu.github.io/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Haber Robotu" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- Google AdSense (Auto Ads) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6477894031302669"
          crossorigin="anonymous"></script>

  <style>
    :root{
      --bg:#0f172a;
      --bg-card:#020617;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --accent:#facc15;
      --accent-soft:rgba(250,204,21,.12);
      --border:#1f2937;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1f2937 0, #020617 55%);
      color:var(--text);
    }
    a{ color:inherit; }

    /* Sayfa düzeni: orta içerik + sağ/sol boşluklar (Auto Ads için) */
    .page{ position:relative; min-height:100vh; }
    .shell{ max-width:1100px; margin:0 auto; padding:16px 12px 48px; }

    header{
      display:flex;
      align-items:center;
      gap:12px;
      padding:16px 18px;
      border-radius:14px;
      background: linear-gradient(135deg, rgba(15,23,42,0.95), rgba(15,23,42,0.98));
      border:1px solid rgba(148,163,184,0.18);
      box-shadow:0 24px 80px rgba(0,0,0,0.55);
      position:sticky;
      top:8px;
      z-index:20;
      backdrop-filter: blur(16px);
      flex-wrap:wrap;
    }
    .logo{
      width:38px; height:38px; border-radius:12px;
      background: radial-gradient(circle at 20% 0%, #facc15, #f97316);
      display:flex; align-items:center; justify-content:center;
      color:#020617; font-weight:900; font-size:18px;
      box-shadow:0 0 0 2px rgba(15,23,42,0.9), 0 16px 45px rgba(250,204,21,0.45);
      flex:0 0 auto;
    }
    .title-wrap{ flex:1 1 240px; min-width:240px; }
    .title{ font-size:20px; font-weight:700; letter-spacing:.02em; }
    .subtitle{ font-size:13px; color:var(--muted); }
    .top-nav{ display:flex; flex-wrap:wrap; gap:12px; font-size:13px; margin-top:6px; }
    .top-nav a{ color:#facc15; text-decoration:none; }
    .pill{
      font-size:11px;
      padding:4px 9px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.35);
      color:var(--muted);
      background: rgba(15,23,42,0.9);
      white-space:nowrap;
    }

    .toolbar{
      margin-top:18px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }
    .filters{ display:flex; flex-wrap:wrap; gap:8px; }
    .btn-filter{
      border-radius:999px;
      font-size:13px;
      padding:5px 12px;
      border:1px solid var(--border);
      background: rgba(15,23,42,0.9);
      color:var(--muted);
      cursor:pointer;
      transition: all .15s ease;
      user-select:none;
    }
    .btn-filter.active{
      background:var(--accent-soft);
      border-color:var(--accent);
      color:#fefce8;
    }

    .status{
      font-size:12px;
      color:var(--muted);
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }

    /* Manuel yenile butonu: ikon */
    .btn-icon{
      width:34px; height:34px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.35);
      background: rgba(15,23,42,0.9);
      color: var(--accent);
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-size:16px;
      line-height:1;
      user-select:none;
    }
    .btn-icon[disabled]{ opacity:.55; cursor:not-allowed; }
    .btn-icon.spinning{ animation: spin .75s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    .grid{
      margin-top:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .card{
      display:grid;
      grid-template-columns:200px minmax(0,1fr);
      gap:14px;
      padding:12px;
      border-radius:14px;
      background: rgba(15,23,42,0.96);
      border:1px solid rgba(31,41,55,0.9);
      box-shadow:0 14px 40px rgba(0,0,0,0.65);
    }
    .thumb-wrap{
      border-radius:10px;
      overflow:hidden;
      background: radial-gradient(circle at 10% 0%, #1f2937, #020617);
      border:1px solid rgba(31,41,55,0.9);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:11px;
      color:var(--muted);
      text-align:center;
      padding:6px;
      min-height:120px;
    }
    .thumb-wrap img{ width:100%; height:100%; object-fit:cover; display:block; }

    .card-body{ display:flex; flex-direction:column; gap:6px; min-width:0; }
    .meta-line{
      display:flex; flex-wrap:wrap; gap:6px; align-items:center;
      font-size:11px; color:var(--muted);
    }
    .badge-source{
      padding:2px 7px;
      border-radius:999px;
      border:1px solid rgba(55,65,81,0.9);
      background: rgba(15,23,42,0.9);
      max-width: 100%;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .badge-tag{
      padding:2px 7px;
      border-radius:999px;
      background: rgba(34,197,94,0.08);
      border:1px solid rgba(34,197,94,0.25);
      color:#bbf7d0;
    }
    .badge-cat{
      padding:2px 7px;
      border-radius:999px;
      background: rgba(59,130,246,0.12);
      border:1px solid rgba(59,130,246,0.35);
      color:#bfdbfe;
    }
    .headline{
      font-size:16px;
      font-weight:600;
      color:#f9fafb;
      margin:2px 0;
      line-height:1.25;
      word-break:break-word;
    }
    .summary{
      font-size:13px;
      color:#d1d5db;
      word-break:break-word;
    }
    .actions{
      margin-top:6px;
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
    .btn-read{
      font-size:12px;
      padding:5px 11px;
      border-radius:999px;
      border:none;
      cursor:pointer;
      background: var(--accent);
      color:#1f2937;
      font-weight:600;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:4px;
    }
    .btn-read:hover{ filter: brightness(1.08); }

    .btn-detail{
      font-size:12px;
      padding:5px 11px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.35);
      background: rgba(15,23,42,0.9);
      color:#fefce8;
      cursor:pointer;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:4px;
    }

    .source-url{
      font-size:11px;
      color:var(--muted);
      max-width: 360px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    footer{
      margin-top:26px;
      font-size:11px;
      color:var(--muted);
      text-align:center;
      line-height:1.5;
    }

    /* Sağ/sol boşluklar: yazı yok, sadece Auto Ads için ayrılmış alan */
    .side-slot{
      position:fixed;
      top:70px;
      width:260px;
      height:calc(100vh - 100px);
      border-radius:14px;
      border:1px solid rgba(148,163,184,0.10);
      background: rgba(15,23,42,0.08);
      display:none;
      z-index:15;
      overflow:hidden;
      pointer-events:none;
    }
    .side-slot-left{ left:12px; }
    .side-slot-right{ right:12px; }

    /* Modal */
    .modal-backdrop{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,0.62);
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index:9999;
    }
    .modal-backdrop.open{ display:flex; }
    .modal{
      width:min(980px, 100%);
      max-height:min(86vh, 820px);
      overflow:auto;
      border-radius:18px;
      background: linear-gradient(180deg, rgba(16,28,52,.98), rgba(10,17,32,.98));
      border:1px solid rgba(255,255,255,.12);
      box-shadow: 0 25px 90px rgba(0,0,0,.55);
      padding:16px;
    }
    .modal-top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }
    .modal h3{ margin:0; font-size:20px; line-height:1.25; }
    .modal .small{ color:var(--muted); font-size:12px; margin-top:6px; word-break:break-word; }
    .modal-close{
      padding:8px 10px;
      border-radius:12px;
      border:1px solid rgba(148,163,184,0.35);
      background: rgba(15,23,42,0.9);
      color:#fefce8;
      cursor:pointer;
      user-select:none;
    }
    .modal-body{ margin-top:12px; display:grid; gap:10px; }
    .section{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      border-radius:14px;
      padding:12px;
    }
    .section h4{ margin:0 0 8px; font-size:13px; color:rgba(232,238,252,.92); }
    .section p, .section li{
      margin:0;
      font-size:13px;
      line-height:1.55;
      color:rgba(232,238,252,.78);
      word-break:break-word;
      white-space:pre-wrap;
    }
    .bullets{ margin:0; padding-left:18px; }
    .modal-actions{ display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }

    @media (max-width: 768px){
      header{ flex-direction:column; align-items:flex-start; }
      .title{ font-size:18px; }
      .subtitle{ font-size:12px; }
      .card{ grid-template-columns:1fr; }
      .thumb-wrap{ height:190px; }
    }
    @media (min-width: 1400px){
      .shell{ max-width:900px; }
      .side-slot{ display:block; }
    }
  </style>
</head>

<body>
  <div class="page">
    <div class="side-slot side-slot-left" aria-hidden="true"></div>
    <div class="side-slot side-slot-right" aria-hidden="true"></div>

    <div class="shell">
      <header>
        <div class="logo">HR</div>
        <div class="title-wrap">
          <div class="title">Haber Robotu</div>
          <div class="subtitle">Türkiye ve dünyadan haberler, her saat otomatik güncellenir.</div>
          <div class="top-nav">
            <a href="about.html">Hakkında</a>
            <a href="privacy.html">Gizlilik Politikası</a>
            <a href="terms.html">Kullanım Şartları</a>
            <a href="contact.html">İletişim</a>
          </div>
        </div>
        <div class="pill">Canlı otomatik haber akışı</div>
      </header>

      <!-- Kaynak filtreleri + manuel yenile -->
      <div class="toolbar">
        <div class="filters">
          <button class="btn-filter btn-filter-source active" data-filter-source="all">Tüm Kaynaklar</button>
          <button class="btn-filter btn-filter-source" data-filter-source="tr">Türkiye Kaynaklı</button>
          <button class="btn-filter btn-filter-source" data-filter-source="intl">Yabancı Kaynaklı</button>
        </div>

        <div class="status">
          <button id="btnManualRefresh" class="btn-icon" type="button" title="Manuel yenile" aria-label="Manuel yenile">⟳</button>
          <span id="status">Haberler yükleniyor...</span>
        </div>
      </div>

      <!-- Kategori filtreleri -->
      <div class="toolbar" style="margin-top:8px;">
        <div class="filters">
          <button class="btn-filter btn-filter-cat active" data-filter-cat="all">Tüm Kategoriler</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="gundem">Gündem</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="dunya">Dünya</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="spor">Spor</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="teknoloji">Teknoloji</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="saglik">Sağlık</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="ekonomi">Ekonomi</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="finans">Finans</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="magazin">Magazin</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="bilim">Bilim</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="savunma">Savunma / Askeri</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="oyun">Oyun / Dijital</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="otomobil">Otomobil</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="yasam">Yaşam</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="yerel">Yerel</button>
        </div>
      </div>

      <div class="grid" id="haberler"></div>

      <div style="margin-top:20px; text-align:center; font-size:13px; color:#9ca3af;">
        Bu sayfayı paylaş:
        <a href="https://wa.me/?text=Haber%20Robotu%20-%20Otomatik%20g%C3%BCncel%20haberler%20https%3A%2F%2Fnewest-resu.github.io%2F"
           target="_blank" style="color:#facc15; margin-left:8px; text-decoration:none;">WhatsApp</a>
        <a href="https://twitter.com/intent/tweet?text=Haber%20Robotu%20-%20Otomatik%20g%C3%BCncel%20haberler&url=https%3A%2F%2Fnewest-resu.github.io%2F"
           target="_blank" style="color:#facc15; margin-left:12px; text-decoration:none;">X (Twitter)</a>
        <a href="https://t.me/share/url?url=https%3A%2F%2Fnewest-resu.github.io%2F&text=Haber%20Robotu%20-%20Otomatik%20G%C3%BCncel%20Haberler"
           target="_blank" style="color:#facc15; margin-left:12px; text-decoration:none;">Telegram</a>
      </div>

      <footer>
        İçerikler ilgili haber sitelerinden otomatik olarak derlenir. Başlık ve özetler bilgilendirme amaçlıdır.
        Tam metin yerine özet ve çıkarımlar gösterilir; detay için her haberde “Haberi Oku” bağlantısını kullanabilirsiniz.
      </footer>
    </div>
  </div>

  <!-- MODAL -->
  <div class="modal-backdrop" id="modalBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-top">
        <div>
          <h3 id="modalTitle">Haber</h3>
          <div class="small" id="modalMeta"></div>
        </div>
        <div class="modal-close" id="modalClose">Kapat</div>
      </div>

      <div class="modal-body">
        <div class="section">
          <h4>Uzun Özet</h4>
          <p id="modalLong">—</p>
        </div>
        <div class="section">
          <h4>Neden Önemli?</h4>
          <ul class="bullets" id="modalWhy"></ul>
        </div>
        <div class="section">
          <h4>Arka Plan</h4>
          <ul class="bullets" id="modalBg"></ul>
        </div>
        <div class="section">
          <h4>Olası Etkiler</h4>
          <ul class="bullets" id="modalImp"></ul>
        </div>

        <div class="modal-actions">
          <a class="btn-read" id="modalSource" target="_blank" rel="noopener noreferrer">Kaynağa Git</a>
          <button class="btn-detail" id="modalCopy" type="button">Linki Kopyala</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    let ALL_ARTICLES = [];
    let CURRENT_SOURCE_FILTER = "all";
    let CURRENT_CATEGORY_FILTER = "all";

    // Saatlik otomatik yenileme (60 dk)
    const AUTO_REFRESH_MS = 60 * 60 * 1000;

    const CATEGORY_LABELS = {
      gundem: "Gündem",
      dunya: "Dünya",
      spor: "Spor",
      teknoloji: "Teknoloji",
      saglik: "Sağlık",
      ekonomi: "Ekonomi",
      finans: "Finans",
      magazin: "Magazin",
      bilim: "Bilim",
      savunma: "Savunma / Askeri",
      oyun: "Oyun / Dijital",
      otomobil: "Otomobil",
      yasam: "Yaşam",
      yerel: "Yerel"
    };

    const CATEGORY_KEYWORDS = {
      finans: [
        "bist", "bist100", "bist 100", "hisse", "hisseleri", "borsa",
        "endeks", "swap", "tahvil", "bono", "eurobond",
        "dolar", "usd", "euro", "eur", "sterlin", "gbp",
        "altın", "altin", "gram altın", "ons", "gümüş", "gumus",
        "kripto", "bitcoin", "btc", "ethereum", "eth",
        "fed", "tcmb", "merkez bank", "faiz", "enflasyon",
        "kur", "parite", "spread"
      ],
      spor: [" spor", "maç", "mac ", "lig ", "şampiyona", "gol ", "transfer", "hakem", "derbi", "futbol", "basketbol", "voleybol", "tenis"],
      teknoloji: ["teknoloji", "uygulama", "yazılım", "yazilim", "telefon", "akıllı", "akilli", "android", "ios", "yapay zeka", " ai ", "robot", "çip", "cip ", "işlemci", "islemci", "bilgisayar", "laptop", "apple", "samsung", "google", "microsoft", "uzay", "roket", "uydu"],
      saglik: ["sağlık", "saglik", "hastane", "doktor", "virüs", "virus", "enfeksiyon", "kanser", "tedavi", "ilaç", "ilac", "aşı", "asi ", "covid", "koronavirüs", "koronavirus", "grip", "diyet", "obezite"],
      ekonomi: ["ekonomi", "ekonomik", "ihracat", "ithalat", "yatırım", "yatirim", "gelir", "bütçe", "butce", "vergi", "asgari ücret", "memur maaşı", "sanayi", "üretim", "uret", "işsizlik", "issizlik"],
      magazin: ["magazin", "ünlü", "unlu", "şarkıcı", "sarkici", "oyuncu", "dizi", "film", "evlilik", "boşanma", "bosanma", "aşk", "ask ", "görüntülendi", "konser", "klip", "festival"],
      bilim: ["bilim", "araştırma", "arastirma", "deney", "bilim insanı", "laboratuvar", "keşif", "kesif", "evren", "fizik", "kimya", "biyoloji", "genetik", "astronomi", "nasa", "teleskop"],
      savunma: ["savunma", "savunma sanayii", "ordu", "asker", "tatbikat", "füze", "fuze", "tank", "savaş uçağı", "hava kuvvetleri", "deniz kuvvetleri", "operasyon", "terör", "teror", "saldırı", "saldiri", "nato", "güvenlik güçleri"],
      oyun: ["oyun", "video oyunu", "bilgisayar oyunu", "playstation", "ps4", "ps5", "xbox", "nintendo", "switch", "steam", "epic games", "battle.net", "mobil oyun", "battle royale", "e-spor", "espor", "gamer", "gaming", "call of duty", "pubg", "fortnite", "valorant", "cs2", "counter strike", "league of legends", "dota", "gta", "fifa", "efootball"],
      otomobil: ["otomobil", "araba", "araç ", "arac ", "otomotiv", "sedan", "suv ", "tesla", "bmw", "mercedes", "renault", "hyundai", "trafik kazası", "trafik", "sürücü", "surucu", "otoyol", "togg", "araç muayene", "lastik"],
      yasam: ["yaşam", "yasam", "hayat", "aile", "çocuk", "cocuk", "evlilik", "ilişki", "iliski", "alışveriş", "alisveris", "tatil", "seyahat", "gezi", "yemek", "tarif", "dekorasyon", "hobi", "ev hayatı", "gunluk hayat"],
      yerel: ["yalova", "çınarcık", "cinarcik", "altınova", "termal", "armutlu", "çiftlikköy", "ciftlikkoy", "subaşı", "subasi"]
    };

    function safeText(v){ return (v ?? "").toString().trim(); }

    function getDomain(url){
      try{ return new URL(url).hostname.replace(/^www\./, ""); }
      catch{ return ""; }
    }

    function classifySource(url){
      const d = getDomain(url);
      if(!d) return { label: "Bilinmeyen", type: "intl" };
      const isTr = d.endsWith(".tr");
      return { label: d, type: isTr ? "tr" : "intl" };
    }

    function classifyCategory(article){
      const rssCats = (article.rss_categories || []).map(c => safeText(c).toLowerCase());
      const text = ((safeText(article.title_tr) || safeText(article.title)) + " " + (safeText(article.summary_tr) || safeText(article.summary))).toLowerCase();
      const src = classifySource(article.url);

      const mapFromRss = (c) => {
        if (c.includes("yalova") || c.includes("yerel") || c.includes("local")) return "yerel";
        if (c.includes("finance") || c.includes("finans") || c.includes("markets") || c.includes("market")) return "finans";

        if (c.includes("world") || c.includes("international") || c.includes("global") || c.includes("politic") ||
            c.includes("americas") || c.includes("africa") || c.includes("asia") || c.includes("europe") || c.includes("middle east")) return "dunya";

        if (c.includes("business") || c.includes("economy") || c.includes("ekonomi") || c.includes("money")) return "ekonomi";

        if (c.includes("sport")) return "spor";
        if (c.includes("technology") || c.includes("tech")) return "teknoloji";
        if (c.includes("science") || c.includes("environment")) return "bilim";
        if (c.includes("health") || c.includes("medical") || c.includes("medicine")) return "saglik";
        if (c.includes("entertainment") || c.includes("arts") || c.includes("culture") || c.includes("magazin")) return "magazin";
        if (c.includes("turkiye") || c.includes("türkiye") || c.includes("gündem") || c.includes("gundem")) return "gundem";

        return null;
      };

      for (const rc of rssCats) {
        const mapped = mapFromRss(rc);
        if (mapped) return mapped;
      }

      let bestCat = null;
      let bestScore = 0;
      for (const [cat, keywords] of Object.entries(CATEGORY_KEYWORDS)) {
        let score = 0;
        for (const k of keywords) {
          if (text.includes(k)) score++;
        }
        if (score > bestScore) {
          bestScore = score;
          bestCat = cat;
        }
      }

      if (!bestCat || bestScore === 0) {
        return src.type === "intl" ? "dunya" : "gundem";
      }
      return bestCat;
    }

    function formatTRDate(isoString){
      try{
        const d = new Date(isoString);
        if (isNaN(d.getTime())) return "";
        const dtf = new Intl.DateTimeFormat("tr-TR", {
          timeZone: "Europe/Istanbul",
          year: "numeric", month: "2-digit", day: "2-digit",
          hour: "2-digit", minute: "2-digit"
        });
        return dtf.format(d).replace(",", "");
      }catch{ return ""; }
    }

    function setStatus(count, generatedAtIso){
      const statusEl = document.getElementById("status");
      const formatted = generatedAtIso ? formatTRDate(generatedAtIso) : "";
      const nowFormatted = formatTRDate(new Date().toISOString());
      if (statusEl) {
        statusEl.textContent = formatted
          ? `Toplam ${count} haber • Son güncelleme: ${formatted} (TR)`
          : `Toplam ${count} haber • Son güncelleme: ${nowFormatted} (TR)`;
      }
    }

    function setBullets(id, arr){
      const ul = document.getElementById(id);
      if (!ul) return;
      ul.innerHTML = "";
      (Array.isArray(arr) ? arr : []).forEach(t => {
        const li = document.createElement("li");
        li.textContent = safeText(t);
        ul.appendChild(li);
      });
      if (!ul.children.length){
        const li = document.createElement("li");
        li.textContent = "—";
        ul.appendChild(li);
      }
    }

    // Modal
    const backdrop = document.getElementById("modalBackdrop");
    const modalClose = document.getElementById("modalClose");

    function openModal(a){
      document.getElementById("modalTitle").textContent =
        safeText(a.title_tr) || safeText(a.title) || "Haber";

      const meta = `${safeText(a.source) || getDomain(a.url || "") || "Kaynak"} • ${CATEGORY_LABELS[classifyCategory(a)] || "Genel"} • ${getDomain(a.url || "")}`;
      document.getElementById("modalMeta").textContent = meta;

      document.getElementById("modalLong").textContent =
        safeText(a.summary_tr_long) || safeText(a.summary_tr) || safeText(a.summary) || "—";

      setBullets("modalWhy", a.why_important);
      setBullets("modalBg", a.background);
      setBullets("modalImp", a.possible_impacts);

      const source = document.getElementById("modalSource");
      source.href = a.url || "#";

      const copyBtn = document.getElementById("modalCopy");
      copyBtn.onclick = async () => {
        try{
          await navigator.clipboard.writeText(a.url || "");
          copyBtn.textContent = "Kopyalandı";
          setTimeout(()=> copyBtn.textContent="Linki Kopyala", 1200);
        }catch(_){
          copyBtn.textContent = "Kopyalanamadı";
          setTimeout(()=> copyBtn.textContent="Linki Kopyala", 1200);
        }
      };

      backdrop.classList.add("open");
      backdrop.setAttribute("aria-hidden","false");
      document.body.style.overflow = "hidden";
    }

    function closeModal(){
      backdrop.classList.remove("open");
      backdrop.setAttribute("aria-hidden","true");
      document.body.style.overflow = "";
    }

    if (modalClose) modalClose.addEventListener("click", closeModal);
    if (backdrop) backdrop.addEventListener("click", (e) => { if(e.target === backdrop) closeModal(); });
    document.addEventListener("keydown", (e) => { if(e.key === "Escape") closeModal(); });

    function renderArticles(){
      const container = document.getElementById("haberler");
      container.innerHTML = "";

      const list = ALL_ARTICLES.filter(a => {
        const src = classifySource(a.url);
        if (CURRENT_SOURCE_FILTER === "tr" && src.type !== "tr") return false;
        if (CURRENT_SOURCE_FILTER === "intl" && src.type !== "intl") return false;

        const cat = classifyCategory(a);
        if (CURRENT_CATEGORY_FILTER !== "all" && cat !== CURRENT_CATEGORY_FILTER) return false;

        return true;
      });

      list.forEach((a) => {
        const src = classifySource(a.url);
        const catKey = classifyCategory(a);
        const catLabel = CATEGORY_LABELS[catKey] || "Gündem";

        const title = safeText(a.title_tr) || safeText(a.title) || "Başlık yok";
        const summary = safeText(a.summary_tr) || safeText(a.summary) || "";

        const card = document.createElement("article");
        card.className = "card";

        // Görsel kısmına dokunmuyoruz.
        const imgHtml = a.image
          ? `<img src="${a.image}" alt="" loading="lazy" onerror="this.style.display='none'">`
          : `<div>Görsel bulunamadı</div>`;

        card.innerHTML = `
          <div class="thumb-wrap">${imgHtml}</div>
          <div class="card-body">
            <div class="meta-line">
              <span class="badge-source">${safeText(a.source) || src.label}</span>
              <span class="badge-tag">${src.type === "tr" ? "Türkiye kaynağı" : "Uluslararası kaynak"}</span>
              <span class="badge-cat">${catLabel}</span>
            </div>
            <h2 class="headline">${title}</h2>
            <p class="summary">${summary}</p>
            <div class="actions">
              <button class="btn-detail" type="button" data-open="1">Detay</button>
              <a class="btn-read" href="${a.url}" target="_blank" rel="noopener noreferrer">Haberi Oku</a>
              <span class="source-url">${a.url || ""}</span>
            </div>
          </div>
        `;

        card.querySelector('[data-open="1"]').addEventListener("click", () => openModal(a));
        container.appendChild(card);
      });

      if (list.length === 0){
        container.innerHTML = "<p style='color:#9ca3af;font-size:13px;'>Bu filtreler için gösterilecek haber bulunamadı.</p>";
      }
    }

    async function loadNews({force=false} = {}){
      const statusEl = document.getElementById("status");
      const btn = document.getElementById("btnManualRefresh");

      try{
        if (btn) { btn.disabled = true; btn.classList.add("spinning"); }
        if (statusEl) statusEl.textContent = "Haberler yükleniyor...";

        const url = "./news/latest.json" + (force ? ("?t=" + Date.now()) : "");
        const res = await fetch(url, { cache: "no-store" });
        if (!res.ok) throw new Error("HTTP " + res.status);

        const data = await res.json();
        ALL_ARTICLES = Array.isArray(data.articles) ? data.articles : [];
        setStatus(ALL_ARTICLES.length, data.generated_at || "");
        renderArticles();
      }catch(err){
        console.error(err);
        if (statusEl) statusEl.textContent = "Haber yüklenirken hata oluştu: " + (err?.message || err);
      }finally{
        if (btn) { btn.disabled = false; btn.classList.remove("spinning"); }
      }
    }

    document.addEventListener("click", function(e){
      const srcBtn = e.target.closest(".btn-filter-source");
      if (srcBtn){
        document.querySelectorAll(".btn-filter-source").forEach(b => b.classList.remove("active"));
        srcBtn.classList.add("active");
        CURRENT_SOURCE_FILTER = srcBtn.getAttribute("data-filter-source") || "all";
        renderArticles();
        return;
      }

      const catBtn = e.target.closest(".btn-filter-cat");
      if (catBtn){
        document.querySelectorAll(".btn-filter-cat").forEach(b => b.classList.remove("active"));
        catBtn.classList.add("active");
        CURRENT_CATEGORY_FILTER = catBtn.getAttribute("data-filter-cat") || "all";
        renderArticles();
      }
    });

    // Manuel yenile (ikon)
    const manualBtn = document.getElementById("btnManualRefresh");
    if (manualBtn){
      manualBtn.addEventListener("click", () => loadNews({force:true}));
    }

    // İlk yükleme
    loadNews({force:true});

    // Saatlik otomatik yenileme (sekme görünürse)
    setInterval(() => {
      if (document.visibilityState === "visible") loadNews({force:true});
    }, AUTO_REFRESH_MS);

    // Sekmeye geri gelince de yenile
    document.addEventListener("visibilitychange", () => {
      if (document.visibilityState === "visible") loadNews({force:true});
    });
  </script>
</body>
</html>
