<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Haber Robotu - Otomatik G√ºncel Haberler</title>

  <!-- Google AdSense: Auto Ads (slot yok) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6477894031302669"
    crossorigin="anonymous"></script>

  <style>
    :root{
      --bg:#0f172a;
      --bg2:#0b1222;
      --card:#0b2a3b;
      --card2:#0a2433;
      --border:rgba(255,255,255,.10);
      --text:#e5e7eb;
      --muted:#9ca3af;
      --accent:#facc15;
      --accent2:rgba(250,204,21,.14);
      --shadow: 0 10px 30px rgba(0,0,0,.25);
      --radius:18px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background: radial-gradient(1200px 700px at 20% 0%, #12304a 0%, var(--bg) 55%, #070b16 100%);
      color:var(--text);
    }

    a{color:inherit}
    .container{
      max-width: 1280px;
      margin: 0 auto;
      padding: 14px 14px 70px;
    }

    /* 3 kolon layout (slot yok; sadece bo≈ü kolon/gutter) */
    .layout{
      display:grid;
      grid-template-columns: 220px 1fr 220px;
      gap: 14px;
      align-items:start;
    }

    /* Mobil/tablet tek kolona d√º≈ü */
    @media (max-width: 980px){
      .layout{
        grid-template-columns: 1fr;
      }
      .side{
        display:none;
      }
      .container{
        padding: 12px 12px 60px;
      }
    }

    .side{
      position: sticky;
      top: 86px;
      height: calc(100vh - 110px);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      overflow:hidden;
      padding: 12px;
    }
    .side .hint{
      font-size:12px;
      color:var(--muted);
      line-height:1.35;
    }
    .side .hint b{color:var(--text)}

    /* Header */
    .topbar{
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(10px);
      background: rgba(10,15,30,.72);
      border-bottom: 1px solid var(--border);
    }
    .topbar-inner{
      max-width:1280px;
      margin:0 auto;
      padding: 10px 14px;
      display:flex;
      gap: 10px;
      align-items:center;
      justify-content:space-between;
    }
    .brand{
      display:flex;
      gap: 10px;
      align-items:center;
      min-width: 210px;
    }
    .logo{
      width:42px;height:42px;border-radius:12px;
      display:grid;place-items:center;
      background: rgba(250,204,21,.12);
      border:1px solid rgba(250,204,21,.22);
      font-weight:800;
      color:var(--accent);
      letter-spacing:.5px;
    }
    .brand-title{
      line-height:1.1;
    }
    .brand-title .name{font-weight:800}
    .brand-title .desc{font-size:12px;color:var(--muted)}
    .navlinks{
      display:flex;
      gap: 14px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
      font-size:13px;
      color: var(--muted);
    }
    .navlinks a{
      text-decoration:none;
      padding: 6px 8px;
      border-radius: 10px;
    }
    .navlinks a:hover{
      background: rgba(255,255,255,.06);
      color: var(--text);
    }

    /* Main panel */
    .panel{
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .panel-head{
      padding: 14px 14px 10px;
      border-bottom: 1px solid var(--border);
    }
    .panel-head-top{
      display:flex;
      gap: 10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .headline{
      font-weight:800;
      font-size: 15px;
    }
    .meta{
      font-size: 12px;
      color: var(--muted);
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .meta .pill{
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
    }
    .controls{
      margin-top: 10px;
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap:wrap;
    }

    .search{
      flex: 1 1 260px;
      display:flex;
      gap: 8px;
      align-items:center;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,.22);
      padding: 10px 12px;
    }
    .search input{
      width:100%;
      border:0;
      outline:0;
      background: transparent;
      color: var(--text);
      font-size: 14px;
    }
    .btn{
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-weight:600;
      font-size: 13px;
    }
    .btn:hover{background: rgba(255,255,255,.10)}
    .btn-accent{
      border-color: rgba(250,204,21,.25);
      background: rgba(250,204,21,.12);
      color: #fff;
    }
    .btn-accent:hover{background: rgba(250,204,21,.18)}

    .chips{
      padding: 10px 14px 14px;
      display:flex;
      gap: 8px;
      flex-wrap:wrap;
      border-bottom: 1px solid var(--border);
    }
    .chip{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
      color: var(--text);
      padding: 7px 10px;
      border-radius: 999px;
      font-size: 12px;
      cursor:pointer;
      user-select:none;
    }
    .chip.active{
      border-color: rgba(250,204,21,.35);
      background: rgba(250,204,21,.12);
      color: #fff;
      font-weight:700;
    }

    .list{
      padding: 14px;
      display:flex;
      flex-direction:column;
      gap: 12px;
    }

    .card{
      display:grid;
      grid-template-columns: 140px 1fr;
      gap: 12px;
      padding: 12px;
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(11,42,59,.95), rgba(10,36,51,.95));
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 10px 24px rgba(0,0,0,.20);
      cursor:pointer;
      overflow:hidden;
    }

    /* Mobil: g√∂rsel √ºstte */
    @media (max-width: 640px){
      .card{
        grid-template-columns: 1fr;
      }
      .thumb{
        height: 180px;
      }
    }

    .thumb{
      border-radius: 14px;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.22);
      display:flex;
      align-items:center;
      justify-content:center;
      min-height: 110px;
    }
    .thumb img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .thumb .noimg{
      font-size:12px;
      color: var(--muted);
    }

    .badges{
      display:flex;
      gap: 8px;
      flex-wrap:wrap;
      align-items:center;
      margin-bottom: 8px;
    }
    .badge{
      font-size: 11px;
      padding: 5px 9px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color: var(--text);
    }
    .badge.accent{
      border-color: rgba(250,204,21,.26);
      background: rgba(250,204,21,.12);
      color:#fff;
      font-weight:700;
    }

    .title{
      font-weight: 900;
      font-size: 16px;
      line-height: 1.25;
      margin: 0 0 8px 0;
    }
    .summary{
      margin: 0;
      color: #d1d5db;
      line-height: 1.45;
      font-size: 13px;
      display:-webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow:hidden;
    }
    .card-actions{
      margin-top: 10px;
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }
    .small{
      font-size: 12px;
      color: var(--muted);
      word-break: break-word;
    }

    /* Modal */
    .modal-backdrop{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      z-index: 100;
      padding: 16px;
    }
    .modal-backdrop.show{display:flex}
    .modal{
      width: min(980px, 100%);
      max-height: min(86vh, 900px);
      overflow:auto;
      border-radius: 20px;
      background: linear-gradient(180deg, rgba(15,23,42,.98), rgba(6,10,20,.98));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 30px 80px rgba(0,0,0,.55);
    }
    .modal-head{
      padding: 14px 14px 10px;
      border-bottom: 1px solid rgba(255,255,255,.12);
      display:flex;
      gap: 10px;
      align-items:flex-start;
      justify-content:space-between;
    }
    .modal-title{
      font-weight: 950;
      font-size: 18px;
      line-height:1.25;
      margin:0;
    }
    .modal-sub{
      margin-top:6px;
      color: var(--muted);
      font-size: 12px;
      word-break: break-word;
    }
    .modal-body{
      padding: 14px;
      display:flex;
      flex-direction:column;
      gap: 12px;
    }
    .section{
      border-radius: 16px;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.10);
      padding: 12px;
    }
    .section h3{
      margin: 0 0 8px 0;
      font-size: 13px;
      color: var(--accent);
      letter-spacing:.2px;
    }
    .section p{
      margin:0;
      white-space: pre-wrap;
      line-height:1.55;
      color:#e5e7eb;
      font-size: 13px;
    }
    .section ul{
      margin:0;
      padding-left: 18px;
      color:#e5e7eb;
      line-height:1.55;
      font-size: 13px;
    }

    .modal-actions{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    /* Footer */
    .footer{
      margin-top: 14px;
      padding: 12px 14px;
      color: var(--muted);
      font-size: 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      flex-wrap:wrap;
    }
    .footer a{
      color: var(--muted);
      text-decoration:none;
      padding: 6px 8px;
      border-radius: 10px;
    }
    .footer a:hover{
      color: var(--text);
      background: rgba(255,255,255,.06);
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="logo">HR</div>
        <div class="brand-title">
          <div class="name">Haber Robotu</div>
          <div class="desc">T√ºrkiye ve d√ºnyadan haberler, otomatik g√ºncellenir.</div>
        </div>
      </div>

      <div class="navlinks">
        <a href="about.html">Hakkƒ±nda</a>
        <a href="privacy.html">Gizlilik</a>
        <a href="terms.html">Kullanƒ±m ≈ûartlarƒ±</a>
        <a href="contact.html">ƒ∞leti≈üim</a>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="layout">
      <!-- Sol kolon: slot yok, sadece layout/gutter -->
      <aside class="side" aria-label="Sol kolon">
        <div class="hint">
          <b>Not:</b> Auto Ads a√ßƒ±k. Bu alan bir reklam ‚Äúkutusu‚Äù deƒüildir; sadece 3 kolon d√ºzeni i√ßin ayrƒ±lmƒ±≈ü bo≈üluk/gutter‚Äôdƒ±r.
        </div>
      </aside>

      <!-- Orta kolon -->
      <main class="panel" aria-label="Haber akƒ±≈üƒ±">
        <div class="panel-head">
          <div class="panel-head-top">
            <div class="headline">Canlƒ± otomatik haber akƒ±≈üƒ±</div>
            <div class="meta">
              <span class="pill" id="lastUpdated">G√ºncelleme: -</span>
              <span class="pill" id="countPill">0 haber</span>
            </div>
          </div>

          <div class="controls">
            <div class="search" title="Ba≈ülƒ±k/√∂zet i√ßinde ara">
              <span style="color:var(--muted);font-size:13px;">üîé</span>
              <input id="q" type="search" placeholder="Ara (√∂r. ekonomi, deprem, teknoloji)..." />
            </div>

            <!-- Manuel yenileme (saatlik otomatik yenilemeden baƒüƒ±msƒ±z) -->
            <button class="btn btn-accent" id="btnRefresh" type="button">Yenile</button>
            <button class="btn" id="btnClear" type="button">Sƒ±fƒ±rla</button>
          </div>
        </div>

        <!-- Filtre chip'leri -->
        <div class="chips" id="sourceChips">
          <!-- JS dolduracak -->
        </div>
        <div class="chips" id="categoryChips" style="border-bottom:1px solid var(--border);">
          <!-- JS dolduracak -->
        </div>

        <!-- Liste -->
        <div class="list" id="list">
          <div style="color:var(--muted);font-size:13px;">Y√ºkleniyor‚Ä¶</div>
        </div>

        <div class="footer">
          <div>Kaynak linkleri yayƒ±ncƒ± sitelere aittir. Bu site ‚Äútam metin‚Äù yayƒ±nlamaz.</div>
          <div>
            <a href="about.html">Hakkƒ±nda</a>
            <a href="privacy.html">Gizlilik</a>
            <a href="terms.html">≈ûartlar</a>
            <a href="contact.html">ƒ∞leti≈üim</a>
          </div>
        </div>
      </main>

      <!-- Saƒü kolon: slot yok, sadece layout/gutter -->
      <aside class="side" aria-label="Saƒü kolon">
        <div class="hint">
          <b>ƒ∞pucu:</b> Auto Ads reklamlarƒ± bazen ilk y√ºklemede g√∂r√ºnmeyebilir; Google yerle≈üimi optimize eder.
        </div>
      </aside>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-modal="true" aria-label="Haber detayƒ±">
    <div class="modal">
      <div class="modal-head">
        <div style="min-width:0;">
          <h2 class="modal-title" id="mTitle">-</h2>
          <div class="modal-sub" id="mMeta">-</div>
        </div>
        <div class="modal-actions">
          <button class="btn" id="btnCopy" type="button">Linki kopyala</button>
          <a class="btn btn-accent" id="btnGo" href="#" target="_blank" rel="noopener noreferrer">Kaynaƒüa git</a>
          <button class="btn" id="btnClose" type="button">Kapat</button>
        </div>
      </div>

      <div class="modal-body">
        <div class="section">
          <h3>Uzun √∂zet</h3>
          <p id="mLong">-</p>
        </div>

        <div class="section">
          <h3>Neden √∂nemli?</h3>
          <ul id="mWhy"></ul>
        </div>

        <div class="section">
          <h3>Arka plan</h3>
          <ul id="mBg"></ul>
        </div>

        <div class="section">
          <h3>Olasƒ± etkiler</h3>
          <ul id="mImp"></ul>
        </div>
      </div>
    </div>
  </div>

  <script>
    const NEWS_URL = "news/latest.json";

    const state = {
      raw: [],
      view: [],
      sourceFilter: "T√ºm√º",
      categoryFilter: "T√ºm√º",
      query: ""
    };

    const el = (id) => document.getElementById(id);

    function esc(s){
      return String(s ?? "").replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    function sourceTypeLabel(article){
      // Eƒüer pipeline'da type yoksa url domainine g√∂re basit ayrƒ±m
      try{
        const u = new URL(article.url);
        return u.hostname.endsWith(".tr") ? "T√ºrkiye Kaynaklƒ±" : "Yabancƒ± Kaynaklƒ±";
      }catch(e){
        return "";
      }
    }

    function getDomain(url){
      try{
        const u = new URL(url);
        return u.hostname.replace(/^www\./,"");
      }catch(e){
        return "";
      }
    }

    function uniq(arr){
      return [...new Set(arr)];
    }

    function buildChips(){
      // Kaynak chip'leri
      const sources = uniq(state.raw.map(a => a.source).filter(Boolean));
      const srcWrap = el("sourceChips");
      srcWrap.innerHTML = "";
      const srcAll = ["T√ºm Kaynaklar", ...sources];

      srcAll.forEach((name, idx) => {
        const chip = document.createElement("div");
        chip.className = "chip" + ((idx===0 && state.sourceFilter==="T√ºm√º") || state.sourceFilter===name ? " active" : "");
        chip.textContent = name;
        chip.onclick = () => {
          state.sourceFilter = (idx===0) ? "T√ºm√º" : name;
          applyFilters();
          buildChips();
        };
        srcWrap.appendChild(chip);
      });

      // Kategori chip'leri (rss_categories)
      const cats = uniq(state.raw.flatMap(a => (a.rss_categories || [])).filter(Boolean));
      const catWrap = el("categoryChips");
      catWrap.innerHTML = "";
      const catAll = ["T√ºm√º", ...cats];

      catAll.forEach((name, idx) => {
        const chip = document.createElement("div");
        chip.className = "chip" + ((idx===0 && state.categoryFilter==="T√ºm√º") || state.categoryFilter===name ? " active" : "");
        chip.textContent = name;
        chip.onclick = () => {
          state.categoryFilter = name;
          applyFilters();
          buildChips();
        };
        catWrap.appendChild(chip);
      });
    }

    function applyFilters(){
      const q = (state.query || "").trim().toLowerCase();

      state.view = state.raw.filter(a => {
        if (state.sourceFilter !== "T√ºm√º" && a.source !== state.sourceFilter) return false;
        if (state.categoryFilter !== "T√ºm√º") {
          const c = (a.rss_categories || []);
          if (!c.includes(state.categoryFilter)) return false;
        }
        if (q){
          const t = (a.title_tr || a.title || "").toLowerCase();
          const s = (a.summary_tr || a.summary || "").toLowerCase();
          if (!t.includes(q) && !s.includes(q)) return false;
        }
        return true;
      });

      renderList();
      el("countPill").textContent = `${state.view.length} haber`;
    }

    function imgHtml(a){
      const url = (a.image || "").trim();
      if(!url){
        return `<div class="thumb"><div class="noimg">G√∂rsel yok</div></div>`;
      }
      // bazƒ± siteler hotlink engelleyebilir; onerror fallback
      return `
        <div class="thumb">
          <img src="${esc(url)}" alt="Haber g√∂rseli" loading="lazy"
            onerror="this.closest('.thumb').innerHTML='<div class=&quot;noimg&quot;>G√∂rsel y√ºklenemedi</div>';">
        </div>
      `;
    }

    function renderList(){
      const wrap = el("list");
      if(!state.view.length){
        wrap.innerHTML = `<div style="color:var(--muted);font-size:13px;">Bu filtreler i√ßin haber bulunamadƒ±.</div>`;
        return;
      }

      wrap.innerHTML = "";
      state.view.forEach(a => {
        const card = document.createElement("div");
        card.className = "card";

        const title = a.title_tr || a.title || "Ba≈ülƒ±k yok";
        const summary = a.summary_tr || a.summary || "";
        const src = a.source || getDomain(a.url) || "Kaynak";
        const cat = (a.rss_categories && a.rss_categories[0]) ? a.rss_categories[0] : "Genel";
        const typ = sourceTypeLabel(a);

        card.innerHTML = `
          ${imgHtml(a)}
          <div>
            <div class="badges">
              <span class="badge accent">${esc(src)}</span>
              <span class="badge">${esc(typ || "Kaynak")}</span>
              <span class="badge">${esc(cat)}</span>
            </div>
            <h3 class="title">${esc(title)}</h3>
            <p class="summary">${esc(summary)}</p>

            <div class="card-actions">
              <div class="small">${esc(a.url)}</div>
            </div>
          </div>
        `;

        card.onclick = () => openModal(a);
        wrap.appendChild(card);
      });
    }

    function setListUL(ul, arr){
      ul.innerHTML = "";
      (arr || []).filter(Boolean).slice(0, 8).forEach(t => {
        const li = document.createElement("li");
        li.textContent = t;
        ul.appendChild(li);
      });
      if (!ul.children.length){
        const li = document.createElement("li");
        li.textContent = "‚Äî";
        ul.appendChild(li);
      }
    }

    function openModal(a){
      const title = a.title_tr || a.title || "Ba≈ülƒ±k yok";
      const src = a.source || getDomain(a.url) || "Kaynak";
      const dom = getDomain(a.url);

      el("mTitle").textContent = title;
      el("mMeta").textContent = `${src} ‚Ä¢ ${dom}`;
      el("mLong").textContent = (a.summary_tr_long || a.summary_tr || a.summary || "").trim() || "‚Äî";

      setListUL(el("mWhy"), a.why_important);
      setListUL(el("mBg"), a.background);
      setListUL(el("mImp"), a.possible_impacts);

      el("btnGo").href = a.url || "#";
      el("btnCopy").onclick = async () => {
        try{
          await navigator.clipboard.writeText(a.url || "");
          el("btnCopy").textContent = "Kopyalandƒ±";
          setTimeout(()=> el("btnCopy").textContent="Linki kopyala", 1200);
        }catch(e){
          alert("Kopyalama ba≈üarƒ±sƒ±z. Tarayƒ±cƒ± izin vermedi.");
        }
      };

      el("modalBackdrop").classList.add("show");
      document.body.style.overflow = "hidden";
    }

    function closeModal(){
      el("modalBackdrop").classList.remove("show");
      document.body.style.overflow = "";
    }

    async function loadNews({force=false}={}){
      const wrap = el("list");
      wrap.innerHTML = `<div style="color:var(--muted);font-size:13px;">Y√ºkleniyor‚Ä¶</div>`;

      // cache bust (manuel yenileme)
      const url = force ? `${NEWS_URL}?t=${Date.now()}` : NEWS_URL;

      try{
        const r = await fetch(url, { cache: "no-store" });
        if(!r.ok) throw new Error("JSON alƒ±namadƒ±: " + r.status);
        const data = await r.json();
        const articles = (data.articles || []).slice(0, 200);

        state.raw = articles;

        // UI meta
        const gen = data.generated_at ? new Date(data.generated_at) : null;
        const stamp = gen ? gen.toLocaleString("tr-TR") : "-";
        el("lastUpdated").textContent = `G√ºncelleme: ${stamp}`;
        el("countPill").textContent = `${articles.length} haber`;

        buildChips();
        applyFilters();
      }catch(e){
        wrap.innerHTML = `
          <div style="color:#fca5a5;font-size:13px;">
            Hata: ${esc(e.message || e)}
          </div>
          <button class="btn" type="button" onclick="loadNews({force:true})" style="margin-top:10px;">Tekrar dene</button>
        `;
      }
    }

    // Events
    el("btnClose").onclick = closeModal;
    el("modalBackdrop").addEventListener("click", (ev) => {
      if(ev.target === el("modalBackdrop")) closeModal();
    });
    document.addEventListener("keydown", (ev) => {
      if(ev.key === "Escape") closeModal();
    });

    el("q").addEventListener("input", (ev) => {
      state.query = ev.target.value || "";
      applyFilters();
    });

    el("btnRefresh").addEventListener("click", () => loadNews({force:true}));
    el("btnClear").addEventListener("click", () => {
      state.query = "";
      state.sourceFilter = "T√ºm√º";
      state.categoryFilter = "T√ºm√º";
      el("q").value = "";
      buildChips();
      applyFilters();
    });

    // ƒ∞lk y√ºkleme
    loadNews({force:false});

    // Saatlik otomatik yenileme (istersen kapat: bu satƒ±rƒ± sil)
    setInterval(() => loadNews({force:true}), 60 * 60 * 1000);
  </script>
</body>
</html>
