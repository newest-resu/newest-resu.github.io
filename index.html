<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Haber Robotu – Otomatik Güncel Haberler</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Açıklama & Open Graph -->
  <meta name="description" content="Türkiye ve dünyadan en güncel haberler, her saat otomatik yenilenen akışla tek sayfada.">
  <meta property="og:title" content="Haber Robotu – Otomatik Güncel Haberler">
  <meta property="og:description" content="Türkiye ve dünyadan en güncel haberler, her saat otomatik yenilenen akışla tek sayfada.">
  <meta property="og:url" content="https://newest-resu.github.io/">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Haber Robotu">
  <meta name="twitter:card" content="summary_large_image">

  <!-- Google AdSense (Auto Ads) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6477894031302669" crossorigin="anonymous"></script>

  <style>
    /* Temel stilleme (senin orijinalinden) */
    body { margin:0; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; background:#0f172a; color:#e5e7eb; }
    .shell{ max-width:1100px; margin:0 auto; padding:16px 12px 48px; }
    header{ display:flex; align-items:center; gap:12px; padding:16px 18px; background:rgba(15,23,42,.98); border-radius:12px; }
    header .title{ font-size:20px; font-weight:700; }
    .toolbar{ display:flex; gap:12px; flex-wrap:wrap; }
    .btn-filter{ cursor:pointer; padding:6px 10px; border-radius:999px; background:#1f2937; border:1px solid #374151; color:#e5e7eb; font-size:13px; }
    .btn-filter.active{ background:#facc15; color:#0f172a; border-color:#facc15; }

    #haberler{ margin-top:14px; display:flex; flex-direction:column; gap:12px; }
    .card{ background:rgba(15,23,42,0.96); padding:12px; border-radius:12px; border:1px solid rgba(31,41,55,0.9); }
    .headline{ font-size:16px; font-weight:700; margin:6px 0; color:#f9fafb; }
    .summary{ font-size:13px; color:#d1d5db; }

    .modal-backdrop{ position:fixed; inset:0; background:rgba(2,6,23,.75); display:none; align-items:center; justify-content:center; }
    .modal-backdrop.open{ display:flex; }
    .modal{ background:#111827; border-radius:12px; padding:16px; width:min(90%,680px); }
    .modal-title{ font-size:18px; font-weight:800; }
    .modal-content{ margin-top:8px; font-size:14px; color:#d1d5db; }

  </style>
</head>
<body>

  <div class="shell">
    <header>
      <div class="title">Haber Robotu</div>
      <div style="flex:1"></div>
      <button class="btn-filter" id="btnManualRefresh">Yenile</button>
    </header>

    <!-- Kaynak & Kategori Filtre -->
    <div class="toolbar">
      <button class="btn-filter btn-filter-source active" data-filter-source="all">Tüm Kaynaklar</button>
      <button class="btn-filter btn-filter-source" data-filter-source="tr">Türkiye Kaynaklı</button>
      <button class="btn-filter btn-filter-source" data-filter-source="intl">Yabancı Kaynaklı</button>
    </div>
    <div class="toolbar">
      <button class="btn-filter btn-filter-cat active" data-filter-cat="all">Tüm Kategoriler</button>
      <button class="btn-filter btn-filter-cat" data-filter-cat="yerel">Yerel</button>
      <button class="btn-filter btn-filter-cat" data-filter-cat="gundem">Gündem</button>
      <button class="btn-filter btn-filter-cat" data-filter-cat="dunya">Dünya</button>
      <button class="btn-filter btn-filter-cat" data-filter-cat="spor">Spor</button>
      <button class="btn-filter btn-filter-cat" data-filter-cat="teknoloji">Teknoloji</button>
      <button class="btn-filter btn-filter-cat" data-filter-cat="saglik">Sağlık</button>
      <button class="btn-filter btn-filter-cat" data-filter-cat="ekonomi">Ekonomi</button>
      <button class="btn-filter btn-filter-cat" data-filter-cat="finans">Finans</button>
      <button class="btn-filter btn-filter-cat" data-filter-cat="magazin">Magazin</button>
      <button class="btn-filter btn-filter-cat" data-filter-cat="bilim">Bilim</button>
      <button class="btn-filter btn-filter-cat" data-filter-cat="savunma">Savunma / Askeri</button>
      <button class="btn-filter btn-filter-cat" data-filter-cat="oyun">Oyun / Dijital</button>
      <button class="btn-filter btn-filter-cat" data-filter-cat="otomobil">Otomobil</button>
      <button class="btn-filter btn-filter-cat" data-filter-cat="yasam">Yaşam</button>
    </div>

    <div id="status"></div>
    <div id="haberler"></div>
  </div>

  <!-- Modal -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal">
      <div class="modal-title" id="modalTitle"></div>
      <div class="modal-content" id="modalContent"></div>
    </div>
  </div>

  <script>
    let ALL_ARTICLES=[],
        CURRENT_SOURCE_FILTER="all",
        CURRENT_CATEGORY_FILTER="all",
        LAST_FETCH_TIMESTAMP="";

    const CATEGORY_LABELS={
      yerel:"Yerel",gundem:"Gündem",dunya:"Dünya",spor:"Spor",
      teknoloji:"Teknoloji",saglik:"Sağlık",ekonomi:"Ekonomi",
      finans:"Finans",magazin:"Magazin",bilim:"Bilim",
      savunma:"Savunma / Askeri",oyun:"Oyun / Dijital",
      otomobil:"Otomobil",yasam:"Yaşam"
    };

    function safeText(v){return(v??"").toString().trim();}
    function getDomain(url){try{return new URL(url).hostname.replace(/^www\./,"");}catch{return"";}}
    function classifySource(url){const d=getDomain(url);return{label:d,type:d.endsWith(".tr")?"tr":"intl"};}

    function classifyCategory(article){
      const txt=(safeText(article.title).toLowerCase()+" "+safeText(article.summary).toLowerCase());
      if(txt.match(/(belediye|valilik|kaymakam|ilçe|ilçe|ilimiz)/))return"yerel";
      for(const cat in CATEGORY_LABELS){
        if(txt.includes(cat))return cat;
      }
      return "gundem";
    }

    function formatTRDate(iso){
      try{
        const d=new Date(iso);
        return d.toLocaleString("tr-TR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});
      }catch{return"";}
    }

    async function loadNews({force=false}={}){
      try{
        const url="./news/latest.json"+(force?("?t="+Date.now()):"");
        const res=await fetch(url,{cache:"no-store"});
        const data=await res.json();
        LAST_FETCH_TIMESTAMP=data.generated_at||"";

        ALL_ARTICLES=(Array.isArray(data.articles)?data.articles:[]).map(a=>{
          return {...a,category:classifyCategory(a)};
        });

        renderArticles();
      }catch(e){
        document.getElementById("status").textContent="Haberler yüklenemedi!";
        console.error(e);
      }
    }

    function renderArticles(){
      const container=document.getElementById("haberler");
      container.innerHTML="";
      document.getElementById("status").textContent=`Toplam ${ALL_ARTICLES.length} haber • Son güncelleme: ${formatTRDate(LAST_FETCH_TIMESTAMP)} (TR)`;

      const list=ALL_ARTICLES.filter(a=>{
        const src=classifySource(a.url);
        if(CURRENT_SOURCE_FILTER==="tr" && src.type!=="tr")return false;
        if(CURRENT_SOURCE_FILTER==="intl" && src.type!=="intl")return false;
        if(CURRENT_CATEGORY_FILTER!=="all" && a.category!==CURRENT_CATEGORY_FILTER)return false;
        return true;
      });

      if(!list.length){container.innerHTML="<p>Bu filtreler için haber yok.</p>";return;}

      list.forEach(a=>{
        const div=document.createElement("div");
        div.className="card";
        div.innerHTML=`
          <div class="headline">${safeText(a.title)}</div>
          <div class="summary">${safeText(a.summary)}</div>
        `;
        div.addEventListener("click",()=>{
          document.getElementById("modalTitle").textContent=safeText(a.title);
          document.getElementById("modalContent").textContent=safeText(a.summary);
          document.getElementById("modalBackdrop").classList.add("open");
        });
        container.appendChild(div);
      });
    }

    document.getElementById("btnManualRefresh").addEventListener("click",()=>loadNews({force:true}));

    document.addEventListener("click",function(e){
      const srcBtn=e.target.closest(".btn-filter-source");
      if(srcBtn){
        document.querySelectorAll(".btn-filter-source").forEach(b=>b.classList.remove("active"));
        srcBtn.classList.add("active");
        CURRENT_SOURCE_FILTER=srcBtn.getAttribute("data-filter-source")||"all";
        renderArticles();
        return;
      }
      const catBtn=e.target.closest(".btn-filter-cat");
      if(catBtn){
        document.querySelectorAll(".btn-filter-cat").forEach(b=>b.classList.remove("active"));
        catBtn.classList.add("active");
        CURRENT_CATEGORY_FILTER=catBtn.getAttribute("data-filter-cat")||"all";
        renderArticles();
        return;
      }
    });

    document.getElementById("modalBackdrop").addEventListener("click",()=>document.getElementById("modalBackdrop").classList.remove("open"));

    loadNews({force:true});
    setInterval(()=>loadNews({force:true}),60*60*1000);
  </script>

</body>
</html>
