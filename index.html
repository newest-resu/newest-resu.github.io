<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0b1220" />
  <title>Haber Robotu ‚Äì Otomatik G√ºncel Haberler</title>
  <meta name="description" content="T√ºrkiye ve d√ºnyadan haberler, otomatik g√ºncellenir. Ba≈ülƒ±k ve √∂zetler bilgilendirme ama√ßlƒ±dƒ±r." />

  <!-- AdSense Auto Ads (slot yok) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6477894031302669"
          crossorigin="anonymous"></script>

  <style>
    :root{
      --bg0:#070b14;
      --bg1:#0b1220;
      --card:#0e1a2f;
      --card2:#0c1527;
      --text:#e8eefc;
      --muted:#9bb0d5;
      --accent:#f5c542;
      --line:rgba(255,255,255,.08);
      --shadow: 0 16px 50px rgba(0,0,0,.35);
      --radius:18px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background: radial-gradient(1200px 700px at 30% -10%, #172a52 0%, rgba(23,42,82,0) 60%),
                  radial-gradient(1000px 600px at 90% 10%, #1b3a6b 0%, rgba(27,58,107,0) 55%),
                  linear-gradient(180deg, var(--bg1), var(--bg0));
      min-height:100vh;
    }

    .grid{
      display:grid;
      grid-template-columns: 160px 1fr 160px;
      gap:14px;
      align-items:start;
    }
    @media (max-width: 1060px){
      .grid{ grid-template-columns: 1fr; }
      .side{ display:none; }
    }
    .side{
      position:sticky;
      top:14px;
      padding-top:6px;
      min-height: 300px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.02);
      box-shadow: 0 12px 40px rgba(0,0,0,.18);
    }
    .side .hint{
      padding:10px;
      color: rgba(232,238,252,.55);
      font-size:12px;
      line-height:1.45;
    }

    /* Header */
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      margin-bottom:14px;
      flex-wrap:wrap;
    }
    .brand{
      display:flex; align-items:center; gap:12px;
    }
    .logo{
      width:54px; height:54px; border-radius:14px;
      background: var(--accent);
      color:#111;
      font-weight:900;
      display:grid; place-items:center;
      box-shadow: 0 10px 30px rgba(245,197,66,.22);
      flex:0 0 auto;
    }
    .brand h1{
      margin:0; font-size:28px; line-height:1.1;
      letter-spacing:.2px;
    }
    .brand p{ margin:4px 0 0; color:var(--muted); font-size:13px; }

    .navlinks{
      display:flex; flex-wrap:wrap; gap:10px;
      justify-content:flex-end;
    }
    .navlinks a{
      color:var(--muted);
      font-size:13px;
      padding:8px 10px;
      border-radius:12px;
      border:1px solid transparent;
    }
    .navlinks a:hover{
      color:var(--text);
      border-color: rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
    }

    /* Panel / Controls */
    .panel{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:14px;
    }
    .headlineRow{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      margin-bottom:10px;
      flex-wrap:wrap;
    }
    .headlineRow h2{
      margin:0;
      font-size:16px;
      color:var(--text);
      letter-spacing:.2px;
    }
    .subnote{ color:var(--muted); font-size:12px; margin-top:6px; }

    .tools{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-top:10px;
    }
    .btn{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      color: var(--text);
      font-size:13px;
      cursor:pointer;
      user-select:none;
      transition:.15s ease;
    }
    .btn:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.22); }
    .btn.primary{
      border-color: rgba(245,197,66,.45);
      background: rgba(245,197,66,.14);
    }
    .search{
      flex: 1 1 240px;
      display:flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
    }
    .search input{
      width:100%;
      border:0;
      outline:0;
      background:transparent;
      color: var(--text);
      font-size:13px;
    }

    .filters{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:10px;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color:var(--text);
      font-size:13px;
      cursor:pointer;
      user-select:none;
      transition:.15s ease;
    }
    .pill:hover{ transform: translateY(-1px); }
    .pill.active{
      background: rgba(245,197,66,.14);
      border-color: rgba(245,197,66,.35);
      color: var(--text);
    }

    #status{
      margin:10px 0 0;
      color:var(--muted);
      font-size:13px;
    }

    /* List */
    .list{
      display:grid;
      grid-template-columns: 1fr;
      gap:14px;
      margin-top:14px;
    }

    .card{
      display:flex;
      gap:14px;
      padding:14px;
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08);
      box-shadow: 0 12px 40px rgba(0,0,0,.25);
      overflow:hidden;
    }

    /* G√∂rseli b√ºy√ºtt√ºk */
    .thumb{
      width:170px;
      height:120px;
      border-radius:14px;
      overflow:hidden;
      background: rgba(0,0,0,.2);
      flex:0 0 auto;
      display:grid;
      place-items:center;
      border:1px solid rgba(255,255,255,.08);
    }
    .thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
    .thumb .noimg{ color:rgba(255,255,255,.35); font-size:12px; padding:8px; text-align:center; }

    /* Mobilde kart dikey */
    @media (max-width: 640px){
      .card{ flex-direction:column; }
      .thumb{ width:100%; height:190px; }
    }

    .body{ min-width:0; flex:1; }
    .meta{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
      margin-bottom:8px;
    }
    .badge{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color: var(--muted);
    }
    .badge.source{ color:#d9e4ff; }
    .badge.cat{ color:#b8c8f1; }
    .badge.tag{
      color: #111;
      background: rgba(245,197,66,.95);
      border-color: rgba(245,197,66,1);
      font-weight:700;
    }

    .title{
      margin:0;
      font-size:18px;
      line-height:1.25;
      letter-spacing:.1px;
      word-break:break-word;
    }
    .summary{
      margin:8px 0 0;
      color:rgba(232,238,252,.78);
      font-size:14px;
      line-height:1.45;
      word-break:break-word;
    }
    .actions{
      display:flex;
      align-items:center;
      gap:10px;
      margin-top:12px;
      flex-wrap:wrap;
    }
    .url{
      color: rgba(232,238,252,.45);
      font-size:12px;
      max-width:420px;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }

    footer{
      margin-top:16px;
      color:rgba(232,238,252,.55);
      font-size:12px;
      line-height:1.5;
    }

    /* Modal */
    .modalBackdrop{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.58);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:9999;
    }
    .modalBackdrop.open{ display:flex; }
    .modal{
      width:min(980px, 100%);
      max-height: min(86vh, 780px);
      overflow:auto;
      border-radius: 22px;
      background: linear-gradient(180deg, rgba(16,28,52,.98), rgba(10,17,32,.98));
      border:1px solid rgba(255,255,255,.10);
      box-shadow: 0 25px 90px rgba(0,0,0,.55);
      padding:18px;
    }
    .modalTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }
    .modal h3{
      margin:0;
      font-size:22px;
      line-height:1.25;
    }
    .modal .small{
      color:var(--muted);
      font-size:12px;
      margin-top:6px;
      word-break:break-word;
    }
    .close{
      padding:10px 12px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      cursor:pointer;
      color:var(--text);
      user-select:none;
    }
    .modalBody{
      margin-top:14px;
      display:grid;
      gap:12px;
    }
    .section{
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
      border-radius: 16px;
      padding:14px;
    }
    .section h4{
      margin:0 0 10px;
      color:rgba(232,238,252,.92);
      font-size:14px;
      letter-spacing:.2px;
    }
    .section p{
      margin:0;
      color:rgba(232,238,252,.78);
      font-size:14px;
      line-height:1.55;
      white-space:pre-wrap;
      word-break:break-word;
    }
    .bullets{
      margin:0;
      padding-left:18px;
      color:rgba(232,238,252,.78);
      font-size:14px;
      line-height:1.55;
    }
    .modalActions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }
  </style>
</head>

      <!-- MAIN -->
      <main>
        <header>
          <div class="brand">
            <div class="logo">HR</div>
            <div>
              <h1>Haber Robotu</h1>
              <p>T√ºrkiye ve d√ºnyadan haberler, otomatik g√ºncellenir.</p>
            </div>
          </div>

          <nav class="navlinks">
            <a href="/about.html">Hakkƒ±nda</a>
            <a href="/privacy.html">Gizlilik Politikasƒ±</a>
            <a href="/terms.html">Kullanƒ±m ≈ûartlarƒ±</a>
            <a href="/contact.html">ƒ∞leti≈üim</a>
          </nav>
        </header>

        <section class="panel">
          <div class="headlineRow">
            <div>
              <h2>Canlƒ± otomatik haber akƒ±≈üƒ±</h2>
              <div class="subnote">Ba≈ülƒ±k/√∂zet T√ºrk√ße g√∂sterilir. Detayda ‚Äúuzun √∂zet + √ßƒ±karƒ±mlar‚Äù a√ßƒ±lƒ±r.</div>
            </div>
          </div>

          <!-- YENƒ∞: arama + manuel yenile -->
          <div class="tools">
            <div class="search" title="Ba≈ülƒ±k ve √∂zet i√ßinde ara">
              <span style="color:rgba(232,238,252,.55)">üîé</span>
              <input id="q" type="search" placeholder="Ara: ekonomi, teknoloji, deprem..." />
            </div>
            <button class="btn primary" id="btnRefresh" type="button">Yenile</button>
            <button class="btn" id="btnReset" type="button">Sƒ±fƒ±rla</button>
          </div>

          <div class="filters" id="sourceFilters"></div>
          <div class="filters" id="categoryFilters" style="margin-top:8px;"></div>

          <div id="status">Haberler y√ºkleniyor‚Ä¶</div>
          <div class="list" id="newsList"></div>

          <footer>
            ƒ∞√ßerikler ilgili haber sitelerinden otomatik olarak derlenir. Ba≈ülƒ±k ve √∂zetler bilgilendirme ama√ßlƒ±dƒ±r.
            Detaylar i√ßin her haberde ‚ÄúKaynaƒüa Git‚Äù baƒülantƒ±sƒ±nƒ± kullanabilirsiniz.
          </footer>
        </section>
      </main>

  <!-- MODAL -->
  <div class="modalBackdrop" id="modalBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modalTop">
        <div>
          <h3 id="modalTitle">Haber</h3>
          <div class="small" id="modalMeta"></div>
        </div>
        <div class="close" id="modalClose">Kapat</div>
      </div>

      <div class="modalBody">
        <div class="section">
          <h4>Uzun √ñzet</h4>
          <p id="modalLong"></p>
        </div>

        <div class="section">
          <h4>Neden √ñnemli?</h4>
          <ul class="bullets" id="modalWhy"></ul>
        </div>

        <div class="section">
          <h4>Arka Plan</h4>
          <ul class="bullets" id="modalBg"></ul>
        </div>

        <div class="section">
          <h4>Olasƒ± Etkiler</h4>
          <ul class="bullets" id="modalImp"></ul>
        </div>

        <div class="modalActions">
          <a class="btn primary" id="modalSource" target="_blank" rel="noopener noreferrer">Kaynaƒüa Git</a>
          <div class="btn" id="modalCopy">Linki Kopyala</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const LATEST_URL = "/news/latest.json"; // GitHub Pages aynƒ± domainde
    const AUTO_REFRESH_MS = 60 * 60 * 1000; // saatlik

    let ALL = [];
    let VIEW = [];
    let sourceActive = "T√ºm√º";
    let typeActive = "T√ºm√º";
    let categoryActive = "T√ºm√º";
    let query = "";

    function safeText(v){ return (v ?? "").toString().trim(); }

    function getDomain(url){
      try{ return new URL(url).hostname.replace(/^www\./,''); }catch(_){ return ""; }
    }

    function classifySource(article){
      const d = getDomain(article.url || "");
      const isTr = d.endsWith(".tr");
      return { label: article.source || d || "Kaynak", type: isTr ? "tr" : "intl" };
    }

    function categoriesOf(article){
      const cats = Array.isArray(article.rss_categories) ? article.rss_categories : [];
      return cats.map(c => safeText(c)).filter(Boolean);
    }

    function uniq(arr){ return [...new Set(arr)]; }

    function el(tag, attrs={}, html=""){
      const x = document.createElement(tag);
      Object.entries(attrs).forEach(([k,v]) => x.setAttribute(k, v));
      if(html) x.innerHTML = html;
      return x;
    }

    // G√∂rsel: normal -> olmazsa proxy fallback
    function normalizeImageUrl(url){
      const u = safeText(url);
      if(!u) return "";
      return u;
    }
    function proxyImage(url){
      // weserv expects host/path without protocol or with, both can work.
      // En stabil: https://images.weserv.nl/?url=<host/path>&w=420&h=280&fit=cover
      try{
        const u = new URL(url);
        const stripped = (u.host + u.pathname + (u.search || ""));
        return "https://images.weserv.nl/?url=" + encodeURIComponent(stripped) + "&w=420&h=280&fit=cover";
      }catch(e){
        // url parse edilemezse direkt encode dene
        return "https://images.weserv.nl/?url=" + encodeURIComponent(url) + "&w=420&h=280&fit=cover";
      }
    }

    function renderFilters(){
      const srcWrap = document.getElementById("sourceFilters");
      const catWrap = document.getElementById("categoryFilters");
      srcWrap.innerHTML = "";
      catWrap.innerHTML = "";

      const sources = uniq(["T√ºm√º", ...ALL.map(a => (a.source || "Kaynak"))]);
      const types = ["T√ºm√º", "T√ºrkiye Kaynaklƒ±", "Yabancƒ± Kaynaklƒ±"];
      const categories = uniq(["T√ºm√º", ...ALL.flatMap(a => categoriesOf(a))]);

      function pill(text, active, onClick){
        const p = el("div", { class: "pill" + (active ? " active" : "") });
        p.textContent = text;
        p.addEventListener("click", onClick);
        return p;
      }

      sources.forEach(s => srcWrap.appendChild(
        pill(s, sourceActive===s, () => { sourceActive=s; applyAndRender(); renderFilters(); })
      ));
      types.forEach(t => srcWrap.appendChild(
        pill(t, typeActive===t, () => { typeActive=t; applyAndRender(); renderFilters(); })
      ));
      categories.forEach(c => catWrap.appendChild(
        pill(c, categoryActive===c, () => { categoryActive=c; applyAndRender(); renderFilters(); })
      ));
    }

    function filterList(){
      const q = (query || "").toLowerCase().trim();

      return ALL.filter(a => {
        const src = (a.source || "Kaynak");
        const csrc = classifySource(a);
        const cats = categoriesOf(a);

        if(sourceActive !== "T√ºm√º" && src !== sourceActive) return false;
        if(typeActive === "T√ºrkiye Kaynaklƒ±" && csrc.type !== "tr") return false;
        if(typeActive === "Yabancƒ± Kaynaklƒ±" && csrc.type !== "intl") return false;
        if(categoryActive !== "T√ºm√º" && !cats.includes(categoryActive)) return false;

        if(q){
          const t = (safeText(a.title_tr) || safeText(a.title)).toLowerCase();
          const s = (safeText(a.summary_tr) || safeText(a.summary)).toLowerCase();
          if(!t.includes(q) && !s.includes(q)) return false;
        }
        return true;
      });
    }

    function applyAndRender(){
      VIEW = filterList();
      renderList();
    }

    function renderList(){
      const list = document.getElementById("newsList");
      const status = document.getElementById("status");

      status.textContent = VIEW.length
        ? `G√∂sterilen haber: ${VIEW.length}`
        : "Bu filtrelerle haber bulunamadƒ±.";

      list.innerHTML = "";

      VIEW.forEach((a) => {
        const csrc = classifySource(a);
        const cats = categoriesOf(a);
        const catLabel = cats[0] || "Genel";

        const title = safeText(a.title_tr) || safeText(a.title) || "Ba≈ülƒ±k yok";
        const summary = safeText(a.summary_tr) || safeText(a.summary) || "";

        const card = el("div", { class:"card" });

        const thumb = el("div", { class:"thumb" });
        const imgUrl = normalizeImageUrl(a.image);

        if(imgUrl){
          const img = new Image();
          img.src = imgUrl;
          img.alt = title;
          img.loading = "lazy";
          img.decoding = "async";

          // 1. hata -> proxy dene
          img.onerror = () => {
            const p = proxyImage(imgUrl);
            const img2 = new Image();
            img2.src = p;
            img2.alt = title;
            img2.loading = "lazy";
            img2.decoding = "async";
            img2.onerror = () => { thumb.innerHTML = '<div class="noimg">G√∂rsel yok</div>'; };
            thumb.innerHTML = "";
            thumb.appendChild(img2);
          };

          thumb.appendChild(img);
        }else{
          thumb.innerHTML = '<div class="noimg">G√∂rsel yok</div>';
        }

        const body = el("div", { class:"body" });

        const meta = el("div", { class:"meta" });
        meta.appendChild(el("span", { class:"badge source" }, csrc.label));
        meta.appendChild(el("span", { class:"badge tag" }, csrc.type==="tr" ? "T√ºrkiye kaynaƒüƒ±" : "Uluslararasƒ± kaynak"));
        meta.appendChild(el("span", { class:"badge cat" }, catLabel));

        const h = el("h3", { class:"title" });
        h.textContent = title;

        const p = el("p", { class:"summary" });
        p.textContent = summary;

        const actions = el("div", { class:"actions" });

        const openBtn = el("div", { class:"btn primary" });
        openBtn.textContent = "Haberi Oku";
        openBtn.addEventListener("click", () => openModal(a));

        const sourceBtn = el("a", { class:"btn", href: a.url, target:"_blank", rel:"noopener noreferrer" });
        sourceBtn.textContent = "Kaynaƒüa Git";

        const url = el("div", { class:"url" });
        url.textContent = a.url || "";

        actions.appendChild(openBtn);
        actions.appendChild(sourceBtn);
        actions.appendChild(url);

        body.appendChild(meta);
        body.appendChild(h);
        body.appendChild(p);
        body.appendChild(actions);

        card.appendChild(thumb);
        card.appendChild(body);

        list.appendChild(card);
      });
    }

    // Modal
    const backdrop = document.getElementById("modalBackdrop");
    const modalClose = document.getElementById("modalClose");

    function setBullets(id, arr){
      const ul = document.getElementById(id);
      ul.innerHTML = "";
      (Array.isArray(arr) ? arr : []).forEach(t => {
        const li = document.createElement("li");
        li.textContent = safeText(t);
        ul.appendChild(li);
      });
      if(!ul.children.length){
        const li = document.createElement("li");
        li.textContent = "‚Äî";
        ul.appendChild(li);
      }
    }

    function openModal(a){
      document.getElementById("modalTitle").textContent =
        safeText(a.title_tr) || safeText(a.title) || "Haber";

      const meta = `${safeText(a.source) || "Kaynak"} ‚Ä¢ ${categoriesOf(a)[0] || "Genel"} ‚Ä¢ ${getDomain(a.url || "")}`;
      document.getElementById("modalMeta").textContent = meta;

      document.getElementById("modalLong").textContent =
        safeText(a.summary_tr_long) || safeText(a.summary_tr) || safeText(a.summary) || "‚Äî";

      setBullets("modalWhy", a.why_important);
      setBullets("modalBg", a.background);
      setBullets("modalImp", a.possible_impacts);

      const source = document.getElementById("modalSource");
      source.href = a.url || "#";

      const copyBtn = document.getElementById("modalCopy");
      copyBtn.onclick = async () => {
        try{
          await navigator.clipboard.writeText(a.url || "");
          copyBtn.textContent = "Kopyalandƒ±";
          setTimeout(()=> copyBtn.textContent="Linki Kopyala", 1200);
        }catch(_){
          copyBtn.textContent = "Kopyalanamadƒ±";
          setTimeout(()=> copyBtn.textContent="Linki Kopyala", 1200);
        }
      };

      backdrop.classList.add("open");
      backdrop.setAttribute("aria-hidden","false");
      document.body.style.overflow = "hidden";
    }

    function closeModal(){
      backdrop.classList.remove("open");
      backdrop.setAttribute("aria-hidden","true");
      document.body.style.overflow = "";
    }

    modalClose.addEventListener("click", closeModal);
    backdrop.addEventListener("click", (e) => { if(e.target === backdrop) closeModal(); });
    document.addEventListener("keydown", (e) => { if(e.key === "Escape") closeModal(); });

    async function loadNews({force=false}={}){
      const status = document.getElementById("status");
      try{
        status.textContent = "Haberler y√ºkleniyor‚Ä¶";
        const url = LATEST_URL + (force ? ("?t=" + Date.now()) : "");
        const res = await fetch(url, { cache:"no-store" });
        if(!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();
        ALL = Array.isArray(data.articles) ? data.articles : [];
        renderFilters();
        applyAndRender();
      }catch(err){
        status.textContent = "Hata: " + (err?.message || err);
      }
    }

    // Search + buttons
    document.getElementById("q").addEventListener("input", (e) => {
      query = e.target.value || "";
      applyAndRender();
    });

    document.getElementById("btnRefresh").addEventListener("click", () => {
      loadNews({force:true});
    });

    document.getElementById("btnReset").addEventListener("click", () => {
      query = "";
      sourceActive = "T√ºm√º";
      typeActive = "T√ºm√º";
      categoryActive = "T√ºm√º";
      document.getElementById("q").value = "";
      renderFilters();
      applyAndRender();
    });

    // ƒ∞lk y√ºkleme + saatlik otomatik yenileme
    loadNews({force:true});
    setInterval(() => loadNews({force:true}), AUTO_REFRESH_MS);
  </script>
</body>
</html>
