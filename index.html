<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Haber Robotu ‚Äì Otomatik G√ºncel Haberler</title>
  <meta name="description" content="T√ºrkiye ve d√ºnyadan haberler, otomatik g√ºncellenir. Kategori se√ß, √∂zetleri oku, kaynaƒüa git." />

  <!-- Google AdSense Auto Ads (senin client) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6477894031302669"
    crossorigin="anonymous"></script>

  <style>
    :root{
      --bg:#0f172a;
      --bg-card:#0b2340;
      --bg-alt:#0a1a31;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --accent:#facc15;
      --accent-soft:rgba(250,204,21,.14);
      --border:#1f2937;
      --shadow:0 12px 30px rgba(0,0,0,.35);
      --radius:22px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
      color:var(--text);
      background: radial-gradient(1000px 450px at 18% 0%, #1f2a55 0%, rgba(31,42,85,0) 55%),
                  radial-gradient(900px 420px at 80% 10%, #1f2937 0%, rgba(31,41,55,0) 55%),
                  linear-gradient(180deg, #061425 0%, #071a31 40%, #05101e 100%);
    }

    .shell{
      max-width:1160px;
      margin:0 auto;
      padding:16px 12px 64px;
      position:relative;
    }

    /* 3 kolonlu yerle≈üim (masa√ºst√º: sol reklam - i√ßerik - saƒü reklam) */
    .layout{
      display:grid;
      grid-template-columns: 180px 1fr 180px;
      gap:14px;
      align-items:start;
    }
    @media (max-width: 1060px){
      .layout{ grid-template-columns: 1fr; }
      .side-ads{ display:none; }
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:12px 14px;
      border:1px solid var(--border);
      background:rgba(8,18,33,.55);
      backdrop-filter: blur(10px);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      position:sticky;
      top:10px;
      z-index:20;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width: 240px;
    }
    .logo{
      width:52px;height:52px;
      border-radius:14px;
      display:grid;
      place-items:center;
      background: linear-gradient(135deg, #facc15 0%, #f59e0b 100%);
      color:#111827;
      font-weight:900;
      letter-spacing:.5px;
      box-shadow: 0 12px 25px rgba(250,204,21,.12);
      flex:0 0 auto;
    }
    .brand h1{
      font-size:18px;
      margin:0;
      line-height:1.1;
    }
    .brand p{
      margin:3px 0 0;
      color:var(--muted);
      font-size:12.5px;
    }

    .top-actions{
      display:flex;
      align-items:center;
      gap:10px;
      flex: 1 1 auto;
      justify-content:flex-end;
      flex-wrap:wrap;
    }

    .search{
      display:flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border:1px solid var(--border);
      border-radius: 999px;
      background: rgba(3,10,20,.45);
      min-width: 260px;
      max-width: 520px;
      flex: 1 1 320px;
    }
    .search input{
      width:100%;
      border:none;
      outline:none;
      background:transparent;
      color:var(--text);
      font-size:14px;
    }
    .btn{
      border:1px solid var(--border);
      background: rgba(3,10,20,.55);
      color: var(--text);
      padding:8px 12px;
      border-radius: 999px;
      cursor:pointer;
      font-size:13px;
      transition:.15s ease;
      user-select:none;
      white-space:nowrap;
    }
    .btn:hover{ border-color: rgba(250,204,21,.35); box-shadow: 0 0 0 3px rgba(250,204,21,.08); }
    .btn-accent{
      border-color: rgba(250,204,21,.35);
      background: rgba(250,204,21,.08);
    }
    .btn-ghost{
      background: transparent;
      border: none;
      color: var(--muted);
      padding: 6px 8px;
    }
    .btn-ghost:hover{ color: var(--text); }

    .navlinks{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .navlinks a{
      color: var(--muted);
      text-decoration:none;
      font-size:13px;
      padding:6px 8px;
      border-radius: 999px;
    }
    .navlinks a:hover{
      color: var(--text);
      background: rgba(255,255,255,.06);
    }

    .panel{
      margin-top:14px;
      border:1px solid var(--border);
      border-radius: var(--radius);
      background: rgba(8,18,33,.40);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .panel-header{
      padding:12px 14px;
      border-bottom:1px solid rgba(255,255,255,.06);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    .panel-title{
      display:flex; align-items:center; gap:10px;
    }
    .panel-title h2{
      margin:0;
      font-size:16px;
      letter-spacing:.2px;
    }
    .meta{
      font-size:12.5px;
      color: var(--muted);
    }

    .filters{
      padding: 12px 14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    .chip{
      border:1px solid var(--border);
      background: rgba(3,10,20,.45);
      padding:7px 10px;
      border-radius: 999px;
      font-size:13px;
      cursor:pointer;
      color: var(--text);
    }
    .chip[data-active="true"]{
      border-color: rgba(250,204,21,.45);
      background: rgba(250,204,21,.10);
      box-shadow: 0 0 0 3px rgba(250,204,21,.06);
    }

    .content{
      padding: 14px;
    }

    /* AdSense kutularƒ± (Auto ads a√ßƒ±k olsa bile, bu kutular ‚Äúyerle≈üim referansƒ±‚Äù olarak durabilir) */
    .adbox{
      border: 1px dashed rgba(250,204,21,.25);
      background: rgba(250,204,21,.04);
      color: rgba(229,231,235,.85);
      border-radius: 16px;
      padding: 10px 12px;
      margin: 10px 0 16px;
      font-size: 12.5px;
    }
    .adbox strong{ color: var(--accent); }

    .news-grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }

    .card{
      border:1px solid rgba(255,255,255,.06);
      background: linear-gradient(180deg, rgba(255,255,255,.04) 0%, rgba(255,255,255,.02) 100%);
      border-radius: 22px;
      padding: 12px;
      display:grid;
      grid-template-columns: 120px 1fr;
      gap:12px;
      overflow:hidden;
    }
    @media (max-width: 560px){
      .card{ grid-template-columns: 96px 1fr; }
    }
    .thumb{
      width:100%;
      height:84px;
      border-radius: 16px;
      overflow:hidden;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.06);
      display:flex;
      align-items:center;
      justify-content:center;
      color: var(--muted);
      font-size:12px;
    }
    .thumb img{ width:100%; height:100%; object-fit:cover; display:block; }

    .card-body{ min-width:0; }
    .badges{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-bottom:6px;
    }
    .badge{
      font-size:12px;
      padding:4px 8px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(3,10,20,.35);
      color: var(--muted);
    }
    .badge-accent{
      border-color: rgba(250,204,21,.25);
      background: rgba(250,204,21,.07);
      color: rgba(250,204,21,.95);
    }

    .headline{
      margin:0 0 6px;
      font-size:18px;
      line-height:1.2;
      letter-spacing:.2px;
      font-weight:800;
      color: var(--text);
      display:-webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow:hidden;
    }
    .summary{
      margin:0;
      color: rgba(229,231,235,.85);
      font-size:14px;
      line-height:1.45;
      display:-webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow:hidden;
    }

    .card-actions{
      display:flex;
      gap:10px;
      margin-top:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .linkbtn{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius: 12px;
      border:1px solid rgba(250,204,21,.25);
      background: rgba(250,204,21,.08);
      color: rgba(250,204,21,.95);
      text-decoration:none;
      cursor:pointer;
      font-size:13px;
      font-weight:600;
    }
    .linkbtn:hover{ background: rgba(250,204,21,.12); }
    .mutelink{
      color: var(--muted);
      font-size:12.5px;
      text-decoration:none;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      max-width: 520px;
    }
    .mutelink:hover{ color: var(--text); }

    .status{
      padding: 10px 14px 0;
      color: var(--muted);
      font-size:12.5px;
    }

    /* Modal */
    .modal-backdrop{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:60;
      padding: 18px;
    }
    .modal-backdrop[data-open="true"]{ display:flex; }
    .modal{
      width:min(920px, 100%);
      max-height: 86vh;
      overflow:auto;
      border:1px solid rgba(255,255,255,.10);
      border-radius: 22px;
      background: radial-gradient(900px 520px at 0% 0%, rgba(250,204,21,.06) 0%, rgba(0,0,0,0) 55%),
                  rgba(7,17,31,.92);
      box-shadow: 0 30px 70px rgba(0,0,0,.55);
      padding: 14px;
    }
    .modal-head{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      margin-bottom:10px;
    }
    .modal-title{
      margin:0;
      font-size:22px;
      line-height:1.15;
      font-weight:900;
    }
    .modal-close{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: var(--text);
      border-radius: 12px;
      padding: 8px 10px;
      cursor:pointer;
    }
    .modal-close:hover{ border-color: rgba(250,204,21,.25); }

    .modal-meta{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      color: var(--muted);
      font-size: 13px;
      margin-bottom: 10px;
    }
    .modal-body{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    .box{
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
      border-radius: 18px;
      padding: 12px;
    }
    .box h3{
      margin:0 0 8px;
      font-size:14px;
      color: rgba(250,204,21,.95);
      letter-spacing:.2px;
    }
    .box p{
      margin:0;
      color: rgba(229,231,235,.88);
      line-height:1.55;
      font-size: 14px;
      white-space: pre-wrap;
    }
    .box ul{
      margin:0;
      padding-left: 18px;
      color: rgba(229,231,235,.88);
      line-height:1.55;
      font-size: 14px;
    }
    .modal-actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 10px;
    }

    footer{
      margin-top: 14px;
      padding: 12px 8px 0;
      color: var(--muted);
      font-size: 12.5px;
      text-align:center;
    }

    /* Side Ads containers */
    .side-ads{
      position:sticky;
      top:86px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
  </style>
</head>

<body>
  <div class="shell">
    <header>
      <div class="brand">
        <div class="logo">HR</div>
        <div>
          <h1>Haber Robotu</h1>
          <p>T√ºrkiye ve d√ºnyadan haberler, otomatik g√ºncellenir.</p>
        </div>
      </div>

      <div class="top-actions">
        <div class="search" title="Ba≈ülƒ±k/√∂zet i√ßinde ara">
          <span style="color:var(--muted);font-size:14px;">üîé</span>
          <input id="q" type="search" placeholder="Canlƒ± otomatik haber akƒ±≈üƒ±" autocomplete="off" />
        </div>

        <!-- Not: Yenileme butonu yok. Sadece pull-to-refresh / sayfa yenile -->
        <button class="btn btn-accent" id="reloadBtn" style="display:none;">Yenile</button>

        <div class="navlinks">
          <a href="/about.html">Hakkƒ±nda</a>
          <a href="/privacy.html">Gizlilik</a>
          <a href="/terms.html">Kullanƒ±m ≈ûartlarƒ±</a>
          <a href="/contact.html">ƒ∞leti≈üim</a>
        </div>
      </div>
    </header>

    <div class="layout" style="margin-top:14px;">
      <!-- Left side ad (desktop) -->
      <aside class="side-ads side-ads-left side-ads" aria-label="Sol reklam alanƒ±">
        <div class="adbox">
          <strong>Sol Kenar Reklam</strong><br />
          Auto-ads a√ßƒ±k; istersen buraya 160x600 / 300x600 birim ekleyebilirsin.
          <!-- √ñrnek AdSense unit: (istersen sonradan ekle) -->
          <!--
          <ins class="adsbygoogle"
               style="display:inline-block;width:160px;height:600px"
               data-ad-client="ca-pub-6477894031302669"
               data-ad-slot="SLOT_ID"></ins>
          <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
          -->
        </div>
      </aside>

      <!-- Main -->
      <main>
        <section class="panel" aria-label="Haber listesi">
          <div class="panel-header">
            <div class="panel-title">
              <h2>Canlƒ± otomatik haber akƒ±≈üƒ±</h2>
              <span class="meta" id="lastUpdate">‚Äî</span>
            </div>
            <div class="meta" id="countInfo">‚Äî</div>
          </div>

          <div class="filters" aria-label="Kaynak filtreleri">
            <button class="chip" data-filter="source" data-value="all" data-active="true">T√ºm Kaynaklar</button>
            <button class="chip" data-filter="source" data-value="tr">T√ºrkiye Kaynaklƒ±</button>
            <button class="chip" data-filter="source" data-value="intl">Yabancƒ± Kaynaklƒ±</button>
          </div>

          <div class="filters" aria-label="Kategori filtreleri" id="catFilters">
            <!-- Dinamik doldurulacak -->
          </div>

          <div class="content">
            <!-- Top banner ad placement -->
            <div class="adbox">
              <strong>√úst Banner Reklam Alanƒ±</strong> (Auto-ads a√ßƒ±k; istersen 728x90 birim ekleyebilirsin.)
            </div>

            <div class="status" id="status">Haberler y√ºkleniyor‚Ä¶</div>
            <div class="news-grid" id="news"></div>

            <!-- In-feed / bottom ad placement -->
            <div class="adbox" style="margin-top:16px;">
              <strong>Alt Banner / Native Reklam Alanƒ±</strong> (Sponsorlu i√ßerik veya ikinci AdSense birimi i√ßin ideal alan.)
            </div>

            <footer>
              ƒ∞√ßerikler ilgili haber sitelerinden otomatik olarak derlenir. Ba≈ülƒ±k ve √∂zetler bilgilendirme ama√ßlƒ±dƒ±r.
              Detaylar i√ßin modal i√ßinden ‚ÄúKaynaƒüa git‚Äù ile orijinal habere gidebilirsiniz.
            </footer>
          </div>
        </section>
      </main>

      <!-- Right side ad (desktop) -->
      <aside class="side-ads side-ads-right side-ads" aria-label="Saƒü reklam alanƒ±">
        <div class="adbox">
          <strong>Saƒü Kenar Reklam</strong><br />
          Auto-ads a√ßƒ±k; istersen buraya ikinci skyscraper veya sponsor logo ekleyebilirsin.
        </div>
      </aside>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal-backdrop" id="modalBackdrop" data-open="false" role="dialog" aria-modal="true" aria-label="Haber detayƒ±">
    <div class="modal">
      <div class="modal-head">
        <h2 class="modal-title" id="modalTitle">‚Äî</h2>
        <button class="modal-close" id="modalClose" aria-label="Kapat">Kapat</button>
      </div>

      <div class="modal-meta" id="modalMeta"></div>

      <div class="modal-body">
        <div class="box">
          <h3>Uzun √ñzet</h3>
          <p id="modalLong">‚Äî</p>
        </div>

        <div class="box" id="boxWhy" style="display:none;">
          <h3>Neden √∂nemli?</h3>
          <ul id="modalWhy"></ul>
        </div>

        <div class="box" id="boxBg" style="display:none;">
          <h3>Arka plan</h3>
          <ul id="modalBg"></ul>
        </div>

        <div class="box" id="boxImp" style="display:none;">
          <h3>Olasƒ± etkiler</h3>
          <ul id="modalImp"></ul>
        </div>

        <div class="modal-actions">
          <a class="linkbtn" id="modalSource" href="#" target="_blank" rel="noopener noreferrer">Kaynaƒüa git</a>
          <button class="btn" id="copyBtn">Linki kopyala</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // --- Config
    const JSON_URL = "/news/latest.json";
    const DEFAULT_CATS = [
      "T√ºm√º", "G√ºndem", "T√ºrkiye", "D√ºnya", "Spor", "Teknoloji", "Saƒülƒ±k", "Ekonomi",
      "Magazin", "Bilim", "Savunma / Askeri", "Oyun / Dijital", "Otomobil", "Ya≈üam"
    ];

    // --- State
    let allArticles = [];
    let sourceMode = "all"; // all | tr | intl
    let activeCat = "T√ºm√º";
    let qText = "";

    // --- Helpers
    function esc(s){ return (s ?? "").toString().replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
    function domainOf(url){
      try{ return new URL(url).hostname.replace(/^www\./,''); } catch { return ""; }
    }
    function isTRSource(article){
      // Basit heuristik: rss_categories i√ßinde T√ºrkiye varsa TR say
      const cats = (article.rss_categories || []).map(x => (x||"").toLowerCase());
      if (cats.includes("t√ºrkiye") || cats.includes("turkiye")) return true;
      // Kaynak adƒ± TR yayƒ±ncƒ± ise
      const src = (article.source || "").toLowerCase();
      if (src.includes("h√ºrriyet") || src.includes("hurriyet") || src.includes("cnn t√ºrk") || src.includes("cnnturk")) return true;
      // URL .tr ise TR
      const d = domainOf(article.url || "");
      if (d.endsWith(".tr")) return true;
      return false;
    }
    function getCategory(article){
      // generator: rss_categories: [category]
      const rc = (article.rss_categories || []).filter(Boolean);
      if (rc.length) return rc[0];
      return "G√ºndem";
    }
    function normalizeText(s){
      return (s || "").toString().replace(/\s+/g,' ').trim();
    }
    function setActiveChip(groupEl, value){
      [...groupEl.querySelectorAll(".chip")].forEach(btn => {
        btn.dataset.active = (btn.dataset.value === value) ? "true" : "false";
      });
    }

    // --- Render filters
    function renderCategoryFilters(){
      const el = document.getElementById("catFilters");
      el.innerHTML = "";

      // Kategorileri: DEFAULT + JSON i√ßinden gelenler
      const fromData = new Set(allArticles.map(a => getCategory(a)).filter(Boolean));
      const merged = [...new Set([...DEFAULT_CATS, ...fromData])];

      merged.forEach((c, idx) => {
        const btn = document.createElement("button");
        btn.className = "chip";
        btn.dataset.filter = "cat";
        btn.dataset.value = c;
        btn.dataset.active = (c === activeCat) ? "true" : "false";
        btn.textContent = c;
        btn.addEventListener("click", () => {
          activeCat = c;
          setActiveChip(el, c);
          render();
        });
        el.appendChild(btn);
      });

      // ƒ∞lk y√ºklemede "T√ºm√º" yoksa
      if (!merged.includes("T√ºm√º")){
        activeCat = merged[0] || "T√ºm√º";
      }
    }

    // --- Render list
    function applyFilters(list){
      let out = list.slice();

      // source
      if (sourceMode === "tr") out = out.filter(a => isTRSource(a));
      if (sourceMode === "intl") out = out.filter(a => !isTRSource(a));

      // category
      if (activeCat && activeCat !== "T√ºm√º"){
        out = out.filter(a => getCategory(a) === activeCat);
      }

      // search
      if (qText){
        const q = qText.toLowerCase();
        out = out.filter(a => {
          const t = normalizeText(a.title_tr || a.title || "").toLowerCase();
          const s = normalizeText(a.summary_tr || a.summary || "").toLowerCase();
          return t.includes(q) || s.includes(q);
        });
      }

      return out;
    }

    function render(){
      const status = document.getElementById("status");
      const grid = document.getElementById("news");
      const countInfo = document.getElementById("countInfo");

      const filtered = applyFilters(allArticles);
      countInfo.textContent = filtered.length ? `${filtered.length} haber` : "Haber yok";

      if (!filtered.length){
        status.textContent = "Bu filtreler i√ßin g√∂sterilecek haber bulunamadƒ±.";
        grid.innerHTML = "";
        return;
      }

      status.textContent = "";
      grid.innerHTML = "";

      filtered.forEach((a, idx) => {
        const card = document.createElement("div");
        card.className = "card";

        const img = (a.image || "").trim();
        const title = normalizeText(a.title_tr || a.title || "Ba≈ülƒ±k yok");
        const summary = normalizeText(a.summary_tr || a.summary || "");
        const cat = getCategory(a);
        const src = normalizeText(a.source || domainOf(a.url) || "Kaynak");
        const trTag = isTRSource(a) ? "T√ºrkiye Kaynaklƒ±" : "Yabancƒ± Kaynaklƒ±";

        const thumb = document.createElement("div");
        thumb.className = "thumb";
        if (img){
          const im = document.createElement("img");
          im.src = img;
          im.alt = title;
          im.loading = "lazy";
          im.onerror = () => { thumb.textContent = "G√∂rsel yok"; };
          thumb.appendChild(im);
        } else {
          thumb.textContent = "G√∂rsel yok";
        }

        const body = document.createElement("div");
        body.className = "card-body";

        const badges = document.createElement("div");
        badges.className = "badges";

        const b1 = document.createElement("span");
        b1.className = "badge badge-accent";
        b1.textContent = src;

        const b2 = document.createElement("span");
        b2.className = "badge";
        b2.textContent = trTag;

        const b3 = document.createElement("span");
        b3.className = "badge";
        b3.textContent = cat;

        badges.appendChild(b1); badges.appendChild(b2); badges.appendChild(b3);

        const h = document.createElement("h3");
        h.className = "headline";
        h.textContent = title;

        const p = document.createElement("p");
        p.className = "summary";
        p.textContent = summary || "‚Äî";

        const actions = document.createElement("div");
        actions.className = "card-actions";

        const open = document.createElement("button");
        open.className = "linkbtn";
        open.type = "button";
        open.textContent = "Uygulama i√ßinde a√ß";
        open.addEventListener("click", () => openModal(a));

        const link = document.createElement("a");
        link.className = "mutelink";
        link.href = a.url;
        link.target = "_blank";
        link.rel = "noopener noreferrer";
        link.textContent = a.url;

        actions.appendChild(open);
        actions.appendChild(link);

        body.appendChild(badges);
        body.appendChild(h);
        body.appendChild(p);
        body.appendChild(actions);

        card.appendChild(thumb);
        card.appendChild(body);

        grid.appendChild(card);

        // Basit in-feed ad referansƒ±: her 8 kartta bir k√º√ß√ºk kutu
        if ((idx+1) % 8 === 0){
          const ad = document.createElement("div");
          ad.className = "adbox";
          ad.innerHTML = "<strong>In-feed Reklam Alanƒ±</strong> (Auto-ads a√ßƒ±k; istersen buraya native/in-article birim ekleyebilirsin.)";
          grid.appendChild(ad);
        }
      });
    }

    // --- Modal
    function fillBullets(ul, items){
      ul.innerHTML = "";
      (items || []).filter(Boolean).forEach(t => {
        const li = document.createElement("li");
        li.textContent = normalizeText(t);
        ul.appendChild(li);
      });
    }

    function openModal(article){
      const bd = document.getElementById("modalBackdrop");
      const title = document.getElementById("modalTitle");
      const meta = document.getElementById("modalMeta");
      const longEl = document.getElementById("modalLong");
      const srcBtn = document.getElementById("modalSource");
      const copyBtn = document.getElementById("copyBtn");

      const boxWhy = document.getElementById("boxWhy");
      const boxBg = document.getElementById("boxBg");
      const boxImp = document.getElementById("boxImp");

      const t = normalizeText(article.title_tr || article.title || "Haber");
      const s = normalizeText(article.source || domainOf(article.url) || "Kaynak");
      const cat = getCategory(article);
      const trTag = isTRSource(article) ? "T√ºrkiye Kaynaklƒ±" : "Yabancƒ± Kaynaklƒ±";

      title.textContent = t;
      meta.textContent = `${s} ‚Ä¢ ${trTag} ‚Ä¢ ${cat}`;

      const longTxt = normalizeText(article.summary_tr_long || article.summary_tr || article.summary || "");
      longEl.textContent = longTxt || "‚Äî";

      srcBtn.href = article.url;

      // Bullets
      const why = (article.why_important || []);
      const bg = (article.background || []);
      const imp = (article.possible_impacts || []);

      if (why.length){ boxWhy.style.display="block"; fillBullets(document.getElementById("modalWhy"), why); }
      else { boxWhy.style.display="none"; }

      if (bg.length){ boxBg.style.display="block"; fillBullets(document.getElementById("modalBg"), bg); }
      else { boxBg.style.display="none"; }

      if (imp.length){ boxImp.style.display="block"; fillBullets(document.getElementById("modalImp"), imp); }
      else { boxImp.style.display="none"; }

      copyBtn.onclick = async () => {
        try{
          await navigator.clipboard.writeText(article.url);
          copyBtn.textContent = "Kopyalandƒ±";
          setTimeout(()=> copyBtn.textContent="Linki kopyala", 1200);
        }catch{
          alert("Kopyalama ba≈üarƒ±sƒ±z. Linki manuel kopyalayabilirsin.");
        }
      };

      bd.dataset.open = "true";
    }

    function closeModal(){
      document.getElementById("modalBackdrop").dataset.open = "false";
    }

    // --- Fetch
    async function loadNews(){
      const status = document.getElementById("status");
      status.textContent = "Haberler y√ºkleniyor‚Ä¶";
      try{
        const r = await fetch(JSON_URL, { cache: "no-store" });
        if (!r.ok) throw new Error("JSON alƒ±namadƒ±: " + r.status);
        const data = await r.json();
        const articles = data.articles || [];

        // normalize
        allArticles = articles.map(a => ({
          id: a.id,
          url: a.url,
          image: a.image || "",
          source: a.source || "",
          rss_categories: a.rss_categories || [],
          title: a.title || "",
          summary: a.summary || "",
          title_tr: a.title_tr || "",
          summary_tr: a.summary_tr || "",
          summary_tr_long: a.summary_tr_long || "",
          why_important: a.why_important || [],
          background: a.background || [],
          possible_impacts: a.possible_impacts || []
        }));

        const gen = data.generated_at ? new Date(data.generated_at) : null;
        const lastUpdate = document.getElementById("lastUpdate");
        lastUpdate.textContent = gen ? ("G√ºncelleme: " + gen.toLocaleString("tr-TR")) : "‚Äî";

        renderCategoryFilters();
        render();
      } catch (e){
        status.textContent = "Hata: " + (e && e.message ? e.message : e);
        document.getElementById("news").innerHTML = "";
      }
    }

    // --- Events
    // source chips
    document.querySelectorAll('.chip[data-filter="source"]').forEach(btn => {
      btn.addEventListener("click", () => {
        sourceMode = btn.dataset.value;
        const group = btn.parentElement;
        setActiveChip(group, sourceMode);
        render();
      });
    });

    // search
    document.getElementById("q").addEventListener("input", (e) => {
      qText = (e.target.value || "").trim();
      render();
    });

    // modal close
    document.getElementById("modalClose").addEventListener("click", closeModal);
    document.getElementById("modalBackdrop").addEventListener("click", (e) => {
      if (e.target.id === "modalBackdrop") closeModal();
    });
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeModal();
    });

    // Pull-to-refresh: mobilde ‚Äúyukarƒ±dan √ßek‚Äù zaten tarayƒ±cƒ±da sayfa yenileme ile √ßalƒ±≈üƒ±r.
    // Biz ayrƒ±ca periyodik otomatik yenileme yapabiliriz (sayfa a√ßƒ±kken):
    // (istersen kapatƒ±rƒ±z)
    setInterval(() => {
      loadNews();
    }, 60 * 1000); // 60 sn

    // init
    loadNews();
  </script>
</body>
</html>
