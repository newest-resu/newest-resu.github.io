<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Haber Robotu – Otomatik Güncel Haberler</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Açıklama & Open Graph -->
  <meta name="description" content="Türkiye ve dünyadan en güncel haberler, her saat otomatik yenilenen akışla tek sayfada. Spor, teknoloji, ekonomi, sağlık ve daha fazlası.">
  <meta property="og:title" content="Haber Robotu – Otomatik Güncel Haberler">
  <meta property="og:description" content="Türkiye ve dünyadan en güncel haberler, her saat otomatik yenilenen akışla tek sayfada.">
  <meta property="og:url" content="https://newest-resu.github.io/">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Haber Robotu">
  <meta name="twitter:card" content="summary_large_image">

  <!-- Google AdSense (Auto Ads) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6477894031302669"
          crossorigin="anonymous"></script>

  <style>
    :root {
      --bg: #0f172a;
      --bg-card: #020617;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --accent: #facc15;
      --accent-soft: rgba(250, 204, 21, 0.12);
      --border: #1f2937;

      --modal-bg: rgba(2,6,23,.72);
      --panel: rgba(15,23,42,0.96);
      --panel-2: rgba(15,23,42,0.90);
      --shadow: 0 24px 90px rgba(0,0,0,.62);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1f2937 0, #020617 55%);
      color: var(--text);
    }
    a { color: inherit; text-decoration: none; }

    /* Sayfa düzeni: orta içerik + sağ/sol boşluklar (Auto Ads için) */
    .page { position: relative; min-height: 100vh; }
    .shell {
      max-width: 1100px;
      margin: 0 auto;
      padding: 16px 12px 48px;
    }

    header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px 18px;
      border-radius: 14px;
      background: linear-gradient(135deg, rgba(15,23,42,0.95), rgba(15,23,42,0.98));
      border: 1px solid rgba(148,163,184,0.18);
      box-shadow: 0 24px 80px rgba(0,0,0,0.55);
      position: sticky;
      top: 8px;
      z-index: 20;
      backdrop-filter: blur(16px);
      flex-wrap: wrap;
    }
    .logo {
      width: 38px;
      height: 38px;
      border-radius: 12px;
      background: radial-gradient(circle at 20% 0%, #facc15, #f97316);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #020617;
      font-weight: 900;
      font-size: 18px;
      box-shadow: 0 0 0 2px rgba(15,23,42,0.9), 0 16px 45px rgba(250,204,21,0.45);
      flex: 0 0 auto;
    }
    .title-wrap { flex: 1 1 200px; min-width: 220px; }
    .title { font-size: 20px; font-weight: 700; letter-spacing: .02em; }
    .subtitle { font-size: 13px; color: var(--muted); margin-top: 2px; }
    .top-nav {
      display: flex; flex-wrap: wrap; gap: 12px;
      font-size: 13px;
      margin-top: 8px;
    }
    .top-nav a { color: #facc15; }
    .pill {
      font-size: 11px;
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.35);
      color: var(--muted);
      background: rgba(15,23,42,0.9);
      white-space: nowrap;
      flex: 0 0 auto;
    }

    /* Toolbar */
    .toolbar {
      margin-top: 18px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
    }
    .filters { display: flex; flex-wrap: wrap; gap: 8px; }
    .btn-filter {
      border-radius: 999px;
      font-size: 13px;
      padding: 5px 12px;
      border: 1px solid var(--border);
      background: rgba(15,23,42,0.9);
      color: var(--muted);
      cursor: pointer;
      transition: all .15s ease;
      user-select: none;
    }
    .btn-filter.active {
      background: var(--accent-soft);
      border-color: var(--accent);
      color: #fefce8;
    }
    .status {
      font-size: 12px;
      color: var(--muted);
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    /* Manuel yenileme ikon butonu */
    .icon-btn {
      width: 36px; height: 36px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.30);
      background: rgba(15,23,42,0.9);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
      user-select: none;
    }
    .icon-btn:hover { transform: translateY(-1px); border-color: rgba(250,204,21,.55); }
    .icon-btn:active { transform: translateY(0px) scale(.98); }
    .icon-btn svg { width: 18px; height: 18px; fill: none; stroke: #facc15; stroke-width: 2; }
    .icon-btn.spin svg { animation: spin .9s linear infinite; }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

    /* Liste */
    .grid {
      margin-top: 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .card {
      display: grid;
      grid-template-columns: 200px minmax(0,1fr);
      gap: 14px;
      padding: 12px;
      border-radius: 14px;
      background: rgba(15,23,42,0.96);
      border: 1px solid rgba(31,41,55,0.9);
      box-shadow: 0 14px 40px rgba(0,0,0,0.65);
    }
    .thumb-wrap {
      border-radius: 10px;
      overflow: hidden;
      background: radial-gradient(circle at 10% 0%, #1f2937, #020617);
      border: 1px solid rgba(31,41,55,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: var(--muted);
      text-align: center;
      padding: 6px;
      min-height: 120px;
    }
    .thumb-wrap img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .card-body {
      display: flex;
      flex-direction: column;
      gap: 6px;
      min-width: 0;
    }
    .meta-line {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
      font-size: 11px;
      color: var(--muted);
    }
    .badge-source {
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,0.9);
      background: rgba(15,23,42,0.9);
    }
    .badge-tag {
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(34,197,94,0.08);
      border: 1px solid rgba(34,197,94,0.25);
      color: #bbf7d0;
    }
    .badge-cat {
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(59,130,246,0.12);
      border: 1px solid rgba(59,130,246,0.35);
      color: #bfdbfe;
    }
    .headline {
      font-size: 16px;
      font-weight: 700;
      color: #f9fafb;
      margin: 2px 0;
      line-height: 1.25;
      word-break: break-word;
    }
    .summary {
      font-size: 13px;
      color: #d1d5db;
      line-height: 1.45;
      word-break: break-word;
    }
    .actions {
      margin-top: 6px;
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }
    .btn-read {
      font-size: 12px;
      padding: 6px 12px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: var(--accent);
      color: #1f2937;
      font-weight: 700;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      user-select: none;
    }
    .btn-read:hover { filter: brightness(1.08); }
    .btn-ghost {
      font-size: 12px;
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.28);
      background: rgba(15,23,42,0.88);
      color: #e5e7eb;
      cursor: pointer;
      user-select: none;
    }
    .btn-ghost:hover { border-color: rgba(250,204,21,.45); }
    .source-url {
      font-size: 11px;
      color: var(--muted);
      max-width: 320px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Sağ/sol boşluklar: yazı yok */
    .side-slot {
      position: fixed;
      top: 70px;
      width: 260px;
      height: calc(100vh - 100px);
      border-radius: 14px;
      border: 1px solid rgba(148,163,184,0.10);
      background: rgba(15,23,42,0.08);
      display: none;
      z-index: 15;
      overflow: hidden;
      pointer-events: none;
    }
    .side-slot-left { left: 12px; }
    .side-slot-right { right: 12px; }

    /* Modal */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: var(--modal-bg);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px 12px;
      z-index: 999;
    }
    .modal-backdrop.open { display: flex; }
    .modal {
      width: min(980px, 100%);
      max-height: min(86vh, 860px);
      overflow: auto;
      border-radius: 16px;
      background: linear-gradient(180deg, rgba(15,23,42,.98), rgba(2,6,23,.98));
      border: 1px solid rgba(148,163,184,0.18);
      box-shadow: var(--shadow);
      padding: 14px;
    }
    .modal-top {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 12px;
      padding: 6px 6px 10px;
    }
    .modal-title {
      font-size: 18px;
      font-weight: 800;
      line-height: 1.25;
      margin: 0;
      word-break: break-word;
    }
    .modal-meta {
      margin-top: 6px;
      font-size: 12px;
      color: var(--muted);
      word-break: break-word;
    }
    .modal-close {
      width: 36px; height: 36px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.28);
      background: rgba(15,23,42,0.88);
      color: #e5e7eb;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      flex: 0 0 auto;
    }
    .modal-close:hover { border-color: rgba(250,204,21,.45); }

    .modal-sections {
      display: grid;
      gap: 10px;
      padding: 0 6px 6px;
    }
    .section {
      border-radius: 14px;
      background: rgba(15,23,42,0.78);
      border: 1px solid rgba(148,163,184,0.14);
      padding: 12px;
    }
    .section h3 {
      margin: 0 0 8px;
      font-size: 13px;
      letter-spacing: .02em;
      color: #f9fafb;
    }
    .section p {
      margin: 0;
      color: #d1d5db;
      font-size: 14px;
      line-height: 1.6;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .bullets {
      margin: 0;
      padding-left: 18px;
      color: #d1d5db;
      font-size: 14px;
      line-height: 1.6;
    }
    .modal-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
      padding: 8px 6px 0;
    }

    footer {
      margin-top: 26px;
      font-size: 11px;
      color: var(--muted);
      text-align: center;
      line-height: 1.5;
    }

    @media (max-width: 768px) {
      header { flex-direction: column; align-items: flex-start; }
      .title { font-size: 18px; }
      .subtitle { font-size: 12px; }
      .card { grid-template-columns: 1fr; }
      .thumb-wrap { height: 190px; }
      .source-url { max-width: 100%; }
    }
    @media (min-width: 1400px) {
      .shell { max-width: 900px; }
      .side-slot { display: block; }
    }
  </style>
</head>

<body>
  <div class="page">
    <!-- SOL boş alan (yazı yok) -->
    <div class="side-slot side-slot-left" aria-hidden="true"></div>
    <!-- SAĞ boş alan (yazı yok) -->
    <div class="side-slot side-slot-right" aria-hidden="true"></div>

    <div class="shell">
      <header>
        <div class="logo">HR</div>
        <div class="title-wrap">
          <div class="title">Haber Robotu</div>
          <div class="subtitle">Türkiye ve dünyadan haberler, her saat otomatik güncellenir.</div>
          <div class="top-nav">
            <a href="about.html">Hakkında</a>
            <a href="privacy.html">Gizlilik Politikası</a>
            <a href="terms.html">Kullanım Şartları</a>
            <a href="contact.html">İletişim</a>
          </div>
        </div>
        <div class="pill">Canlı otomatik haber akışı</div>
      </header>

      <!-- Kaynak filtreleri -->
      <div class="toolbar">
        <div class="filters">
          <button class="btn-filter btn-filter-source active" data-filter-source="all">Tüm Kaynaklar</button>
          <button class="btn-filter btn-filter-source" data-filter-source="tr">Türkiye Kaynaklı</button>
          <button class="btn-filter btn-filter-source" data-filter-source="intl">Yabancı Kaynaklı</button>
        </div>

        <div class="status">
          <button class="icon-btn" id="btnRefresh" type="button" title="Yenile">
            <!-- Refresh icon -->
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M20 12a8 8 0 1 1-2.34-5.66" />
              <path d="M20 4v6h-6" />
            </svg>
          </button>
          <span id="status">Haberler yükleniyor...</span>
        </div>
      </div>

      <!-- Kategori filtreleri -->
      <div class="toolbar" style="margin-top:8px;">
        <div class="filters">
          <button class="btn-filter btn-filter-cat active" data-filter-cat="all">Tüm Kategoriler</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="gundem">Gündem</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="dunya">Dünya</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="yerel">Yerel</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="spor">Spor</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="teknoloji">Teknoloji</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="saglik">Sağlık</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="ekonomi">Ekonomi</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="finans">Finans</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="magazin">Magazin</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="bilim">Bilim</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="savunma">Savunma / Askeri</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="oyun">Oyun / Dijital</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="otomobil">Otomobil</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="yasam">Yaşam</button>
        </div>
      </div>

      <div class="grid" id="haberler"></div>

      <!-- Paylaş bloğu -->
      <div style="margin-top:20px; text-align:center; font-size:13px; color:#9ca3af;">
        Bu sayfayı paylaş:
        <a href="https://wa.me/?text=Haber%20Robotu%20-%20Otomatik%20g%C3%BCncel%20haberler%20https%3A%2F%2Fnewest-resu.github.io%2F"
           target="_blank" rel="noopener noreferrer"
           style="color:#facc15; margin-left:8px; text-decoration:none;">WhatsApp</a>
        <a href="https://twitter.com/intent/tweet?text=Haber%20Robotu%20-%20Otomatik%20g%C3%BCncel%20haberler&url=https%3A%2F%2Fnewest-resu.github.io%2F"
           target="_blank" rel="noopener noreferrer"
           style="color:#facc15; margin-left:12px; text-decoration:none;">X (Twitter)</a>
        <a href="https://t.me/share/url?url=https%3A%2F%2Fnewest-resu.github.io%2F&text=Haber%20Robotu%20-%20Otomatik%20G%C3%BCncel%20Haberler"
           target="_blank" rel="noopener noreferrer"
           style="color:#facc15; margin-left:12px; text-decoration:none;">Telegram</a>
      </div>

      <footer>
        İçerikler ilgili haber sitelerinden otomatik olarak derlenir. Başlık ve özetler bilgilendirme amaçlıdır.
        Detaylar için modal içinden “Kaynağa Git” bağlantısını kullanabilirsiniz.
      </footer>
    </div>
  </div>

  <!-- MODAL -->
  <div class="modal-backdrop" id="modalBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-top">
        <div>
          <h2 class="modal-title" id="modalTitle">Haber</h2>
          <div class="modal-meta" id="modalMeta"></div>
        </div>
        <button class="modal-close" id="modalClose" type="button" title="Kapat">✕</button>
      </div>

      <div class="modal-sections">
        <div class="section">
          <h3>Uzun Özet</h3>
          <p id="modalLong">—</p>
        </div>

        <div class="section">
          <h3>Neden Önemli?</h3>
          <ul class="bullets" id="modalWhy"></ul>
        </div>

        <div class="section">
          <h3>Arka Plan</h3>
          <ul class="bullets" id="modalBg"></ul>
        </div>

        <div class="section">
          <h3>Olası Etkiler</h3>
          <ul class="bullets" id="modalImp"></ul>
        </div>

        <div class="modal-actions">
          <a class="btn-read" id="modalSource" href="#" target="_blank" rel="noopener noreferrer">Kaynağa Git</a>
          <button class="btn-ghost" id="modalCopy" type="button">Linki Kopyala</button>
          <a class="btn-ghost" id="modalShareX" href="#" target="_blank" rel="noopener noreferrer">X’te Paylaş</a>
          <a class="btn-ghost" id="modalShareWa" href="#" target="_blank" rel="noopener noreferrer">WhatsApp</a>
          <a class="btn-ghost" id="modalShareTg" href="#" target="_blank" rel="noopener noreferrer">Telegram</a>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ===============================
   MODAL KONTROL + GERÇEKÇİ METİN
   =============================== */

const modal = document.getElementById("modalBackdrop");
const modalTitle = document.getElementById("modalTitle");
const modalSummary = document.getElementById("modalLong");
const modalMeta = document.getElementById("modalMeta");
const modalLink = document.getElementById("modalSource");

function formatDate(dateStr) {
  if (!dateStr) return "";
  const d = new Date(dateStr);
  return d.toLocaleString("tr-TR", {
    day: "2-digit",
    month: "long",
    year: "numeric",
    hour: "2-digit",
    minute: "2-digit"
  });
}

function whyImportant(article) {
  const cat = article.category;

  const map = {
    gundem: "Kamuoyunu ve güncel gelişmeleri doğrudan ilgilendiren bir konu.",
    yerel: "Bölgesel gelişmeler açısından vatandaşları yakından ilgilendiriyor.",
    dunya: "Uluslararası dengeleri ve küresel gündemi etkileyebilecek bir gelişme.",
    ekonomi: "Ekonomik göstergeler ve piyasa beklentileri açısından önem taşıyor.",
    teknoloji: "Teknolojik gelişmelerin günlük yaşama etkisini ortaya koyuyor.",
    spor: "Spor dünyasında dengeleri etkileyebilecek bir gelişme."
  };

  return map[cat] || "Gündemde öne çıkan ve dikkat çeken bir gelişme.";
}

function openModal(article) {
  modalTitle.textContent = article.title;
  // Uzun özet
toggleSection("modalLong", !!modalSummary.textContent.trim());

// Neden Önemli
toggleSection("modalWhy", article.category);

// Arka Plan
toggleSection("modalBg", Array.isArray(article.background) && article.background.length);

// Olası Etkiler
toggleSection("modalImp", Array.isArray(article.impacts) && article.impacts.length);
  
  modalSummary.textContent =
  article.summary ||
  article.description ||
  `${article.title} başlıklı bu haber ${article.source} tarafından yayımlandı. 
Gelişmenin ayrıntıları ve resmi açıklamalar için kaynağa gitmeniz önerilir.`;
  
  modalMeta.innerHTML = `
    <strong>Kaynak:</strong> ${article.source} <br>
    <strong>Yayın:</strong> ${formatDate(article.published_at)} <br><br>
    <strong>Neden önemli?</strong><br>
    ${whyImportant(article)}
  `;

  modalLink.href = article.url;
  modalLink.target = "_blank";

  modal.classList.add("open");
}
    function toggleSection(sectionId, hasContent) {
  const el = document.getElementById(sectionId);
  if (!el) return;
  el.closest(".section").style.display = hasContent ? "" : "none";
}

function closeModal() {
    const modal = document.getElementById("newsModal");
    if (!modal) return;

    modal.classList.remove("active");
    modal.style.display = "none";
    document.body.style.overflow = "";
}

/* Kart tıklama bağlantısı */
document.addEventListener("click", function (e) {
  const card = e.target.closest(".news-card");
  if (!card) return;

  const index = card.getAttribute("data-index");
  if (index === null) return;

  const article = ALL_ARTICLES[index];
  if (article) openModal(article);
});
  /* =======================
     XSS SAFE HELPERS (EN ÜSTE ALINDI)
  ======================= */
  function escapeHtml(s) {
    const str = (s ?? "").toString();
    return str
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#039;");
  }
  function escapeAttr(s) {
    return escapeHtml(s).replace(/"/g, "&quot;");
  }

  let ALL_ARTICLES = [];
  let CURRENT_SOURCE_FILTER = "all";
  let CURRENT_CATEGORY_FILTER = "all";

  const AUTO_REFRESH_MS = 60 * 60 * 1000;

  const CATEGORY_LABELS = {
    gundem: "Gündem",
    dunya: "Dünya",
    yerel: "Yerel",
    spor: "Spor",
    teknoloji: "Teknoloji",
    saglik: "Sağlık",
    ekonomi: "Ekonomi",
    finans: "Finans",
    magazin: "Magazin",
    bilim: "Bilim",
    savunma: "Savunma / Askeri",
    oyun: "Oyun / Dijital",
    otomobil: "Otomobil",
    yasam: "Yaşam"
  };

  function safeText(v) {
    return (v ?? "").toString().trim();
  }

  function getDomain(url) {
    try {
      return new URL(url).hostname.replace(/^www\./, "");
    } catch {
      return "";
    }
  }

  function classifySource(url) {
    const d = getDomain(url);
    if (!d) return { label: "Bilinmeyen", type: "intl" };
    return { label: d, type: d.endsWith(".tr") ? "tr" : "intl" };
  }

  function classifyCategory(a) {
    return a.category || "gundem";
  }

  function formatTRDate(iso) {
    try {
      return new Intl.DateTimeFormat("tr-TR", {
        dateStyle: "short",
        timeStyle: "short",
        timeZone: "Europe/Istanbul"
      }).format(new Date(iso));
    } catch {
      return "";
    }
  }

  function setStatus(count, iso) {
    const el = document.getElementById("status");
    el.textContent = `Toplam ${count} haber • Son güncelleme: ${formatTRDate(iso)}`;
  }

  function renderArticles() {
    const container = document.getElementById("haberler");
    if (!container) return;

    container.innerHTML = "";

    const filtered = ALL_ARTICLES.filter(a => {
      const src = classifySource(a.url);
      if (CURRENT_SOURCE_FILTER !== "all" && src.type !== CURRENT_SOURCE_FILTER) return false;
      if (CURRENT_CATEGORY_FILTER !== "all" && classifyCategory(a) !== CURRENT_CATEGORY_FILTER) return false;
      return true;
    });

    if (!filtered.length) {
      container.innerHTML = "<p style='color:#9ca3af;font-size:13px;'>Bu filtreler için haber bulunamadı.</p>";
      return;
    }

    filtered.forEach(a => {
      const src = classifySource(a.url);
      const cat = classifyCategory(a);
      const card = document.createElement("article");
      card.className = "card";

      card.innerHTML = `
        <div class="thumb-wrap">
          ${a.image ? `<img src="${escapeAttr(a.image)}" loading="lazy" referrerpolicy="no-referrer">` : "Görsel yok"}
        </div>
        <div class="card-body">
          <div class="meta-line">
            <span class="badge-source">${src.label}</span>
            <span class="badge-tag">${src.type === "tr" ? "Türkiye" : "Yabancı"}</span>
            <span class="badge-cat">${CATEGORY_LABELS[cat] || "Gündem"}</span>
          </div>
          <h2 class="headline">${escapeHtml(a.title_tr || a.title)}</h2>
          <p class="summary">${escapeHtml(a.summary_tr || a.summary || "")}</p>
          <div class="actions">
            <button class="btn-read">Haberi Oku</button>
            <a class="btn-ghost" href="${escapeAttr(a.url)}" target="_blank">Kaynağa Git</a>
          </div>
        </div>
      `;

      card.querySelector(".btn-read").onclick = () => openModal(a);
      container.appendChild(card);
    });
  }

  async function loadNews({ force = true } = {}) {
    const btn = document.getElementById("btnRefresh");
    const status = document.getElementById("status");
    btn.classList.add("spin");

    try {
      const res = await fetch(`./news/latest.json?t=${Date.now()}`, { cache: "no-store" });
      const data = await res.json();
      ALL_ARTICLES = data.articles || [];
      setStatus(ALL_ARTICLES.length, data.generated_at || new Date().toISOString());
      renderArticles();
    } catch (e) {
      status.textContent = "Haberler yüklenemedi.";
      console.error(e);
    } finally {
      btn.classList.remove("spin");
    }
  }

  document.getElementById("btnRefresh").onclick = () => loadNews({ force: true });

  document.addEventListener("click", e => {
    const src = e.target.closest(".btn-filter-source");
    const cat = e.target.closest(".btn-filter-cat");

    if (src) {
      document.querySelectorAll(".btn-filter-source").forEach(b => b.classList.remove("active"));
      src.classList.add("active");
      CURRENT_SOURCE_FILTER = src.dataset.filterSource;
      renderArticles();
    }

    if (cat) {
      document.querySelectorAll(".btn-filter-cat").forEach(b => b.classList.remove("active"));
      cat.classList.add("active");
      CURRENT_CATEGORY_FILTER = cat.dataset.filterCat;
      renderArticles();
    }
    
   document.addEventListener("click", function (e) {
    // X kapatma butonu
    if (e.target.closest(".modal-close, .modal-close-btn, .close-modal")) {
        closeModal();
    }

    // Modal dışına tıklayınca kapatma (overlay)
    if (e.target.classList.contains("modal-overlay")) {
        closeModal();
    }
});

  loadNews({ force: true });
  setInterval(() => document.visibilityState === "visible" && loadNews({ force: true }), AUTO_REFRESH_MS);
</script>
</body>
</html>
