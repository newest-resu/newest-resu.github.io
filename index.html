<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Haber Robotu – Otomatik Güncel Haberler</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="description" content="Türkiye ve dünyadan en güncel haberler, her saat otomatik yenilenen akışla tek sayfada. Spor, teknoloji, ekonomi, sağlık ve daha fazlası.">
  <meta property="og:title" content="Haber Robotu – Otomatik Güncel Haberler">
  <meta property="og:description" content="Türkiye ve dünyadan en güncel haberler, her saat otomatik yenilenen akışla tek sayfada.">
  <meta property="og:url" content="https://newest-resu.github.io/">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Haber Robotu">
  <meta name="twitter:card" content="summary_large_image">

  <!-- Google AdSense (Auto Ads) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6477894031302669"
        crossorigin="anonymous"></script>

  <style>
    :root {
      --bg: #0f172a;
      --bg-card: #020617;
      --bg-alt: #020617;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --accent: #facc15;
      --accent-soft: rgba(250, 204, 21, 0.12);
      --border: #1f2937;
      --radius: 14px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1f2937 0, #020617 55%);
      color: var(--text);
    }

    /* Sayfa düzeni: orta içerik + sağ/sol boşluklar (Auto Ads için) */
    .page { position: relative; min-height: 100vh; }
    .shell { max-width: 1100px; margin: 0 auto; padding: 16px 12px 48px; }

    header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px 18px;
      border-radius: var(--radius);
      background: linear-gradient(135deg, rgba(15,23,42,0.95), rgba(15,23,42,0.98));
      border: 1px solid rgba(148,163,184,0.18);
      box-shadow: 0 24px 80px rgba(0,0,0,0.55);
      position: sticky;
      top: 8px;
      z-index: 20;
      backdrop-filter: blur(16px);
      flex-wrap: wrap;
    }
    .logo {
      width: 38px;
      height: 38px;
      border-radius: 12px;
      background: radial-gradient(circle at 20% 0%, #facc15, #f97316);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #020617;
      font-weight: 900;
      font-size: 18px;
      box-shadow: 0 0 0 2px rgba(15,23,42,0.9), 0 16px 45px rgba(250,204,21,0.45);
      flex: 0 0 auto;
    }

    .title-wrap { flex: 1 1 240px; min-width: 240px; }
    .title { font-size: 20px; font-weight: 700; letter-spacing: .02em; }
    .subtitle { font-size: 13px; color: var(--muted); }

    .pill {
      font-size: 11px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.35);
      color: var(--muted);
      background: rgba(15,23,42,0.9);
      white-space: nowrap;
      flex: 0 0 auto;
    }

    .top-nav {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      font-size: 13px;
      margin-top: 6px;
    }
    .top-nav a { color: #facc15; text-decoration: none; }

    .toolbar {
      margin-top: 18px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
    }
    .filters { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; }

    .btn-filter {
      border-radius: 999px;
      font-size: 13px;
      padding: 7px 12px;
      border: 1px solid var(--border);
      background: rgba(15,23,42,0.9);
      color: var(--muted);
      cursor: pointer;
      transition: all .15s ease;
    }
    .btn-filter.active {
      background: var(--accent-soft);
      border-color: var(--accent);
      color: #fefce8;
    }

    .status { font-size: 12px; color: var(--muted); }

    .refreshBtn{
      width: 36px;
      height: 36px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.25);
      background: rgba(15,23,42,0.65);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: #fefce8;
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
      user-select: none;
    }
    .refreshBtn:hover{
      transform: rotate(20deg);
      border-color: rgba(250,204,21,0.55);
      background: rgba(250,204,21,0.10);
    }
    .refreshBtn.spinning{
      animation: spin .65s linear infinite;
    }
    @keyframes spin{
      from{ transform: rotate(0deg); }
      to{ transform: rotate(360deg); }
    }

    .grid {
      margin-top: 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .card {
      display: grid;
      grid-template-columns: 200px minmax(0,1fr);
      gap: 14px;
      padding: 12px;
      border-radius: var(--radius);
      background: rgba(15,23,42,0.96);
      border: 1px solid rgba(31,41,55,0.9);
      box-shadow: 0 14px 40px rgba(0,0,0,0.65);
      overflow: hidden;
    }

    .thumb-wrap {
      border-radius: 10px;
      overflow: hidden;
      background: radial-gradient(circle at 10% 0%, #1f2937, #020617);
      border: 1px solid rgba(31,41,55,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: var(--muted);
      text-align: center;
      padding: 6px;
      min-height: 120px;
    }
    .thumb-wrap img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .card-body { display: flex; flex-direction: column; gap: 6px; min-width: 0; }

    .meta-line {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
      font-size: 11px;
      color: var(--muted);
    }
    .badge-source {
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,0.9);
      background: rgba(15,23,42,0.9);
    }
    .badge-tag {
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(34,197,94,0.08);
      border: 1px solid rgba(34,197,94,0.25);
      color: #bbf7d0;
    }
    .badge-cat {
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(59,130,246,0.12);
      border: 1px solid rgba(59,130,246,0.35);
      color: #bfdbfe;
    }

    .headline {
      font-size: 16px;
      font-weight: 650;
      color: #f9fafb;
      margin: 2px 0;
      line-height: 1.25;
    }
    .summary { font-size: 13px; color: #d1d5db; line-height: 1.45; }

    .actions {
      margin-top: 8px;
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    /* Haberi Oku daha belirgin */
    .btn-read {
      font-size: 12px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(250,204,21,0.65);
      cursor: pointer;
      background: var(--accent);
      color: #1f2937;
      font-weight: 700;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 10px 26px rgba(250,204,21,0.18);
    }
    .btn-read:hover { filter: brightness(1.06); }

    /* Kaynağa Git daha az belirgin */
    .btn-source {
      font-size: 12px;
      padding: 7px 11px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.22);
      cursor: pointer;
      background: rgba(15,23,42,0.45);
      color: rgba(229,231,235,0.85);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .btn-source:hover { border-color: rgba(148,163,184,0.35); }

    .source-url {
      font-size: 11px;
      color: var(--muted);
      max-width: 240px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    footer {
      margin-top: 26px;
      font-size: 11px;
      color: var(--muted);
      text-align: center;
      line-height: 1.45;
    }

    /* Sağ/sol boşluklar: yazı yok, sadece Auto Ads için ayrılmış alan */
    .side-slot {
      position: fixed;
      top: 70px;
      width: 260px;
      height: calc(100vh - 100px);
      border-radius: var(--radius);
      border: 1px solid rgba(148,163,184,0.10);
      background: rgba(15,23,42,0.08);
      display: none;
      z-index: 15;
      overflow: hidden;
      pointer-events: none;
    }
    .side-slot-left { left: 12px; }
    .side-slot-right { right: 12px; }

    /* Modal */
    .modalBackdrop{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.60);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px;
      z-index: 9999;
    }
    .modalBackdrop.open{ display:flex; }

    .modal{
      width: min(980px, 100%);
      max-height: min(86vh, 780px);
      overflow: auto;
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(16,28,52,.98), rgba(10,17,32,.98));
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 25px 90px rgba(0,0,0,.55);
      padding: 18px;
    }
    .modalTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }
    .modal h3{ margin:0; font-size: 20px; line-height:1.25; }
    .modal .small{
      color: var(--muted);
      font-size: 12px;
      margin-top: 6px;
      word-break: break-word;
    }
    .close{
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      cursor: pointer;
      color: var(--text);
      user-select:none;
      flex: 0 0 auto;
      height: fit-content;
    }
    .modalBody{
      margin-top: 14px;
      display: grid;
      gap: 12px;
    }
    .section{
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
      border-radius: 16px;
      padding: 14px;
    }
    .section h4{
      margin: 0 0 10px;
      color: rgba(232,238,252,.92);
      font-size: 14px;
      letter-spacing: .2px;
    }
    .section p{
      margin: 0;
      color: rgba(232,238,252,.80);
      font-size: 14px;
      line-height: 1.55;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .bullets{
      margin:0;
      padding-left: 18px;
      color: rgba(232,238,252,.80);
      font-size: 14px;
      line-height: 1.55;
    }
    .modalActions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 10px;
      align-items: center;
    }
    .btn{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      color: var(--text);
      font-size:13px;
      cursor:pointer;
      user-select:none;
      transition:.15s ease;
      text-decoration:none;
    }
    .btn:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.22); }
    .btn.primary{
      border-color: rgba(245,197,66,.45);
      background: rgba(245,197,66,.14);
      color: #fefce8;
    }

    @media (max-width: 768px) {
      header { flex-direction: column; align-items: flex-start; }
      .title-wrap { min-width: auto; width: 100%; }
      .title { font-size: 18px; }
      .subtitle { font-size: 12px; }
      .card { grid-template-columns: 1fr; }
      .thumb-wrap { height: 190px; }
      .source-url { max-width: 100%; }
      .toolbar { align-items: flex-start; }
    }

    @media (min-width: 1400px) {
      .shell { max-width: 900px; }
      .side-slot { display: block; }
    }

    /* Modal mobil optimizasyon */
    @media (max-width: 640px){
      .modalBackdrop{ padding:0; }
      .modal{
        width:100%;
        height:100%;
        max-height:100vh;
        border-radius:0;
        padding:14px;
      }
      .modalTop{
        position: sticky;
        top: 0;
        background: linear-gradient(180deg, rgba(16,28,52,.98), rgba(10,17,32,.98));
        padding-bottom: 10px;
        z-index: 2;
      }
    }
  </style>
</head>

<body>
  <div class="page">
    <!-- SOL boş alan (yazı yok) -->
    <div class="side-slot side-slot-left" aria-hidden="true"></div>
    <!-- SAĞ boş alan (yazı yok) -->
    <div class="side-slot side-slot-right" aria-hidden="true"></div>

    <div class="shell">
      <header>
        <div class="logo">HR</div>
        <div class="title-wrap">
          <div class="title">Haber Robotu</div>
          <div class="subtitle">Türkiye ve dünyadan haberler, her saat otomatik güncellenir.</div>
          <div class="top-nav">
            <a href="about.html">Hakkında</a>
            <a href="privacy.html">Gizlilik Politikası</a>
            <a href="terms.html">Kullanım Şartları</a>
            <a href="contact.html">İletişim</a>
          </div>
        </div>
        <div class="pill">Canlı otomatik haber akışı</div>
      </header>

      <!-- Kaynak filtreleri + Manuel yenileme -->
      <div class="toolbar">
        <div class="filters">
          <button class="btn-filter btn-filter-source active" data-filter-source="all">Tüm Kaynaklar</button>
          <button class="btn-filter btn-filter-source" data-filter-source="tr">Türkiye Kaynaklı</button>
          <button class="btn-filter btn-filter-source" data-filter-source="intl">Yabancı Kaynaklı</button>
        </div>

        <div class="filters">
          <div class="status" id="status">Haberler yükleniyor...</div>
          <div class="refreshBtn" id="btnManualRefresh" title="Manuel yenile">
            ↻
          </div>
        </div>
      </div>

      <!-- Kategori filtreleri -->
      <div class="toolbar" style="margin-top:8px;">
        <div class="filters">
          <button class="btn-filter btn-filter-cat active" data-filter-cat="all">Tüm Kategoriler</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="gundem">Gündem</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="dunya">Dünya</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="spor">Spor</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="teknoloji">Teknoloji</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="saglik">Sağlık</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="ekonomi">Ekonomi</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="finans">Finans</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="magazin">Magazin</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="bilim">Bilim</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="savunma">Savunma / Askeri</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="oyun">Oyun / Dijital</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="otomobil">Otomobil</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="yasam">Yaşam</button>
          <button class="btn-filter btn-filter-cat" data-filter-cat="yerel">Yerel</button>
        </div>
      </div>

      <div class="grid" id="haberler"></div>

      <!-- PAYLAŞ BLOĞU -->
      <div style="margin-top:20px; text-align:center; font-size:13px; color:#9ca3af;">
        Bu sayfayı paylaş:
        <a href="https://wa.me/?text=Haber%20Robotu%20-%20Otomatik%20g%C3%BCncel%20haberler%20https%3A%2F%2Fnewest-resu.github.io%2F"
           target="_blank"
           style="color:#facc15; margin-left:8px; text-decoration:none;">
           WhatsApp
        </a>
        <a href="https://twitter.com/intent/tweet?text=Haber%20Robotu%20-%20Otomatik%20g%C3%BCncel%20haberler&url=https%3A%2F%2Fnewest-resu.github.io%2F"
           target="_blank"
           style="color:#facc15; margin-left:12px; text-decoration:none;">
           X (Twitter)
        </a>
        <a href="https://t.me/share/url?url=https%3A%2F%2Fnewest-resu.github.io%2F&text=Haber%20Robotu%20-%20Otomatik%20G%C3%BCncel%20Haberler"
           target="_blank"
           style="color:#facc15; margin-left:12px; text-decoration:none;">
           Telegram
        </a>
      </div>

      <footer>
        İçerikler ilgili haber sitelerinden otomatik olarak derlenir. Başlık ve özetler bilgilendirme amaçlıdır,
        detaylar için her haberdeki bağlantıları kullanabilirsiniz. Modal içeriği “özgün özet + genel çıkarım” prensibiyle sunulur.
      </footer>
    </div>
  </div>

  <!-- MODAL -->
  <div class="modalBackdrop" id="mBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="mTitle">
      <div class="modalTop">
        <div>
          <h3 id="mTitle">Haber</h3>
          <div class="small" id="mMeta"></div>
        </div>
        <div class="close" id="mClose">Kapat</div>
      </div>

      <div class="modalBody">
        <div class="section">
          <h4>Uzun Özet</h4>
          <p id="mLong"></p>
        </div>

        <div class="section">
          <h4>Neden Önemli?</h4>
          <ul class="bullets" id="mWhy"></ul>
        </div>

        <div class="section">
          <h4>Arka Plan</h4>
          <ul class="bullets" id="mBg"></ul>
        </div>

        <div class="section">
          <h4>Olası Etkiler</h4>
          <ul class="bullets" id="mImp"></ul>
        </div>

        <div class="modalActions">
          <a class="btn primary" id="mRead" target="_blank" rel="noopener noreferrer">Haberi Oku</a>
          <a class="btn" id="mSource" target="_blank" rel="noopener noreferrer">Kaynağa Git</a>
          <div class="btn" id="mCopy">Linki Kopyala</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let ALL = [];
    let CURRENT_SOURCE_FILTER = "all";
    let CURRENT_CATEGORY_FILTER = "all";

    const AUTO_REFRESH_MS = 60 * 60 * 1000;

    const CATEGORY_LABELS = {
      gundem: "Gündem",
      dunya: "Dünya",
      spor: "Spor",
      teknoloji: "Teknoloji",
      saglik: "Sağlık",
      ekonomi: "Ekonomi",
      finans: "Finans",
      magazin: "Magazin",
      bilim: "Bilim",
      savunma: "Savunma / Askeri",
      oyun: "Oyun / Dijital",
      otomobil: "Otomobil",
      yasam: "Yaşam",
      yerel: "Yerel"
    };

    // Daha zengin keyword listeleri (TR/EN karışık yakalama)
    const CATEGORY_KEYWORDS = {
      spor: [
        " spor","maç","mac ","lig","şampiyona","gol","transfer","hakem","derbi","futbol","basketbol","voleybol","tenis",
        "formula","f1","motogp","uefa","champions","europa league","premier","la liga","serie a","nba","euroleague","tff"
      ],
      teknoloji: [
        "teknoloji","uygulama","yazılım","yazilim","telefon","akıllı","akilli","android","ios","yapay zeka"," ai ","robot","çip","cip ",
        "işlemci","islemci","bilgisayar","laptop","apple","samsung","google","microsoft","uzay","roket","uydu","startup","girişim",
        "cyber","siber","hack","veri","data","gpu","nvidia","openai","chatgpt","model","llm","chip","semiconductor"
      ],
      saglik: [
        "sağlık","saglik","hastane","doktor","virüs","virus","enfeksiyon","kanser","tedavi","ilaç","ilac","aşı","asi ",
        "covid","koronavirüs","koronavirus","grip","diyet","obezite","psikoloji","mental","sağlık bakanlığı","aile hekimi",
        "epidem","salgın","pandemi","kalp","tansiyon","diabetes","şeker hastalığı","check-up","checkup"
      ],
      ekonomi: [
        "ekonomi","ekonomik","dolar","euro","altın","altin","borsa","faiz","enflasyon","piyasa","kriz","ihracat","ithalat","yatırım","yatirim",
        "gelir","bütçe","butce","vergi","asgari ücret","memur maaşı","tcmb","fed","resesyon","büyüme","gdp","işsizlik","istihdam",
        "kredi","tahvil","bono","kur","swap","cari açık","cari acik"
      ],
      finans: [
        "finans","finance","bank","banka","kredi","mortgage","loan","tahvil","bond","hisse","stock","shares","equity","etf","fon",
        "mutual fund","tefas","temettü","dividend","kâr","kar","bilanç","balance sheet","gelir tablosu","earnings","guidance",
        "kripto","crypto","bitcoin","btc","ethereum","eth","bnb","halving","borsa istanbul","bist","bist100","spk","yatırımcı","yatirimci"
      ],
      magazin: [
        "magazin","ünlü","unlu","şarkıcı","sarkici","oyuncu","dizi","film","evlilik","boşanma","bosanma","aşk","ask ","konser","klip",
        "festival","kırmızı halı","red carpet","celebrity","influencer","sosyal medya","instagram","tiktok"
      ],
      bilim: [
        "bilim","araştırma","arastirma","deney","bilim insanı","laboratuvar","keşif","kesif","evren","fizik","kimya","biyoloji","genetik",
        "astronomi","nasa","teleskop","iklim","climate","enerji","fusion","füzyon","nükleer","nukleer","kuantum","quantum"
      ],
      savunma: [
        "savunma","savunma sanayii","ordu","asker","tatbikat","füze","fuze","tank","savaş uçağı","hava kuvvetleri","deniz kuvvetleri",
        "operasyon","terör","teror","saldırı","saldiri","nato","güvenlik güçleri","drone","iha","siha","missile","navy","air force"
      ],
      oyun: [
        "oyun","video oyunu","bilgisayar oyunu","playstation","ps4","ps5","xbox","nintendo","switch","steam","epic games","battle.net",
        "mobil oyun","battle royale","e-spor","espor","gamer","gaming","call of duty","pubg","fortnite","valorant","cs2","counter strike",
        "league of legends","dota","gta","fifa","efootball","unity","unreal","game studio","patch","update","dlc"
      ],
      otomobil: [
        "otomobil","araba","araç ","arac ","otomotiv","sedan","suv ","tesla","bmw","mercedes","renault","hyundai","trafik kazası","trafik",
        "sürücü","surucu","otoyol","togg","araç muayene","lastik","electric vehicle","ev ","şarj","sarj","batarya","battery","range"
      ],
      yasam: [
        "yaşam","yasam","hayat","aile","çocuk","cocuk","evlilik","ilişki","iliski","alışveriş","alisveris","tatil","seyahat","gezi","yemek",
        "tarif","dekorasyon","hobi","ev hayatı","gunluk hayat","konut","kiralar","kira","eğitim","egitim","üniversite","okul"
      ],
      yerel: [
        "yalova","çınarcık","cinarcik","termal","altınova","altinova","çiftlikköy","ciftlikkoy","armutlu","kadıköy","kadikoy",
        "belediye","valilik","muhtar","yerel","il özel idaresi","il ozel idaresi","imar","altyapı","altyapi","su kesintisi","elektrik kesintisi"
      ]
    };

    function safeText(v){ return (v ?? "").toString().trim(); }

    function getDomain(url){
      try{ return new URL(url).hostname.replace(/^www\./,''); }
      catch(_){ return ""; }
    }

    const TR_DOMAINS = new Set(["aa.com.tr","bloomberght.com","cnn.com.tr","dunya.com","ekonomim.com","finansgundem.com","gazeteduvar.com.tr","haberturk.com","hurriyet.com.tr","milliyet.com.tr","ntv.com.tr","sabah.com.tr","sozcu.com.tr","t24.com.tr","trthaber.com"]);

    function classifySource(url){
      const d = getDomain(url);
      if(!d) return { label: "Bilinmeyen", type: "intl" };

      // TR yayıncıların önemli bir kısmı .com kullandığı için yalnızca ".tr" kontrolü yeterli değil.
      const host = d.toLowerCase();
      const isTr = host.endsWith(".tr") || TR_DOMAINS.has(host);

      return { label: d, type: isTr ? "tr" : "intl" };
    }

    function classifyCategory(article){
      const rssCats = (article.rss_categories || []).map(c => (c || "").toLowerCase());
      const title = safeText(article.title_tr) || safeText(article.title);
      const sum   = safeText(article.summary_tr) || safeText(article.summary);
      const text = (title + " " + sum).toLowerCase();

      // RSS kategori map (geniş)
      const mapFromRss = (c) => {
        if (!c) return null;

        if (
          c.includes("world") || c.includes("international") || c.includes("global") ||
          c.includes("middle east") || c.includes("europe") || c.includes("asia") ||
          c.includes("americas") || c.includes("africa") || c.includes("politic")
        ) return "dunya";

        if (c.includes("business") || c.includes("economy") || c.includes("market") || c.includes("finance") || c.includes("money"))
          return "ekonomi";

        if (c.includes("sport")) return "spor";
        if (c.includes("technology") || c.includes("tech")) return "teknoloji";
        if (c.includes("science") || c.includes("environment")) return "bilim";
        if (c.includes("health") || c.includes("medical") || c.includes("medicine")) return "saglik";
        if (c.includes("entertainment") || c.includes("arts") || c.includes("culture") || c.includes("magazin")) return "magazin";

        if (c.includes("finance") || c.includes("bank") || c.includes("invest") || c.includes("stocks") || c.includes("crypto"))
          return "finans";

        if (c.includes("yalova") || c.includes("local") || c.includes("yerel")) return "yerel";
        if (c.includes("turkiye") || c.includes("türkiye") || c.includes("gundem") || c.includes("gündem") || c.includes("yerel"))
          return "gundem";

        return null;
      };

      for(const rc of rssCats){
        const mapped = mapFromRss(rc);
        if(mapped) return mapped;
      }

      let bestCat = null;
      let bestScore = 0;

      for (const [cat, keywords] of Object.entries(CATEGORY_KEYWORDS)) {
        let score = 0;
        for (const k of keywords) {
          if (text.includes(k)) score++;
        }
        if (score > bestScore) {
          bestScore = score;
          bestCat = cat;
        }
      }

      // Yerel: Yalova anahtarları güçlü ise önceliklendir
      if (bestCat !== "yerel") {
        const yscore = (CATEGORY_KEYWORDS.yerel || []).reduce((acc,k)=> acc + (text.includes(k)?1:0), 0);
        if (yscore >= 2) bestCat = "yerel";
      }

      // Finans: belirgin işaretler varsa ekonomi yerine finans
      if (bestCat === "ekonomi") {
        const fscore = (CATEGORY_KEYWORDS.finans || []).reduce((acc,k)=> acc + (text.includes(k)?1:0), 0);
        if (fscore >= 2) bestCat = "finans";
      }

      if (!bestCat || bestScore === 0) {
        const src = classifySource(article.url || "");
        return src.type === "intl" ? "dunya" : "gundem";
      }

      return bestCat;
    }

    function formatTRDate(isoString) {
      try {
        const d = new Date(isoString);
        if (isNaN(d.getTime())) return "";
        const dtf = new Intl.DateTimeFormat("tr-TR", {
          timeZone: "Europe/Istanbul",
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
          hour: "2-digit",
          minute: "2-digit"
        });
        return dtf.format(d).replace(",", "");
      } catch { return ""; }
    }

    function setStatus(count, generatedAtIso) {
      const status = document.getElementById("status");
      const formatted = generatedAtIso ? formatTRDate(generatedAtIso) : "";
      if (formatted) status.textContent = `Toplam ${count} haber • Son güncelleme: ${formatted} (TRz`;
      else status.textContent = `Toplam ${count} haber • Son güncelleme: ${formatTRDate(new Date().toISOString())} (TR)`;
    }

    // Görsel kısmına dokunmuyoruz (senin şartın)
    function imgHtml(a){
      return a.image
        ? `<img src="${a.image}" alt="" loading="lazy" onerror="this.style.display='none'">`
        : `<div>Görsel bulunamadı</div>`;
    }

    function renderArticles(){
      const container = document.getElementById("haberler");
      container.innerHTML = "";

      const list = ALL.filter(a => {
        const src = classifySource(a.url || "");
        if (CURRENT_SOURCE_FILTER === "tr" && src.type !== "tr") return false;
        if (CURRENT_SOURCE_FILTER === "intl" && src.type !== "intl") return false;

        const cat = classifyCategory(a);
        if (CURRENT_CATEGORY_FILTER !== "all" && cat !== CURRENT_CATEGORY_FILTER) return false;

        return true;
      });

      list.forEach(a => {
        const src = classifySource(a.url || "");
        const catKey = classifyCategory(a);
        const catLabel = CATEGORY_LABELS[catKey] || "Genel";

        const title = safeText(a.title_tr) || safeText(a.title) || "Başlık yok";
        const summary = safeText(a.summary_tr) || safeText(a.summary) || "";

        const card = document.createElement("article");
        card.className = "card";

        card.innerHTML = `
          <div class="thumb-wrap">
            ${imgHtml(a)}
          </div>
          <div class="card-body">
            <div class="meta-line">
              <span class="badge-source">${src.label}</span>
              <span class="badge-tag">${src.type === "tr" ? "Türkiye kaynağı" : "Uluslararası kaynak"}</span>
              <span class="badge-cat">${catLabel}</span>
            </div>
            <h2 class="headline">${title}</h2>
            <p class="summary">${summary}</p>
            <div class="actions">
              <button class="btn-read" data-open="${encodeURIComponent(a.url || "")}">Haberi Oku</button>
              <a class="btn-source" href="${a.url || "#"}" target="_blank" rel="noopener noreferrer">Kaynağa Git</a>
              <span class="source-url">${a.url || ""}</span>
            </div>
          </div>
        `;
        container.appendChild(card);
      });

      if(!list.length){
        container.innerHTML = "<p style='color:#9ca3af;font-size:13px;'>Bu filtreler için gösterilecek haber bulunamadı.</p>";
      }
    }

    function splitSentences(text){
      const t = safeText(text);
      if(!t) return [];
      return t
        .replace(/\s+/g, " ")
        .split(/(?<=[\.\!\?])\s+/)
        .map(s => s.trim())
        .filter(s => s.length >= 35);
    }

    function fallbackBullets(text, max=3){
      const sents = splitSentences(text);
      return sents.slice(0, max);
    }

    function cleanBullets(arr){
      return (Array.isArray(arr) ? arr : [])
        .map(x => safeText(x))
        .map(x => x.replace(/^[-–—•\s]+/,"").trim())
        .filter(x => x && x !== "—" && x !== "-" && x.length >= 12);
    }

    function setBullets(id, arr, fallbackText){
      const ul = document.getElementById(id);
      ul.innerHTML = "";

      const cleaned = cleanBullets(arr);
      const finalArr = cleaned.length ? cleaned : fallbackBullets(fallbackText, 3);

      finalArr.forEach(t => {
        const li = document.createElement("li");
        li.textContent = t;
        ul.appendChild(li);
      });

      if(!ul.children.length){
        const li = document.createElement("li");
        li.textContent = "—";
        ul.appendChild(li);
      }
    }

    function buildLongTR(a){
      const long0 = safeText(a.summary_tr_long);
      const short0 = safeText(a.summary_tr) || safeText(a.summary);
      const base = long0 || short0 || "—";

      if (base.length >= 900) return base;

      const parts = [];
      if (base && base !== "—") parts.push(base);

      const title = safeText(a.title_tr) || safeText(a.title);
      const srcLabel = safeText(a.source) || classifySource(a.url || "").label || "Kaynak";

      const why0 = cleanBullets(a.why_important);
      const bg0  = cleanBullets(a.background);
      const imp0 = cleanBullets(a.possible_impacts);

      const seedText = base !== "—" ? base : (title + ". " + short0);

      const why = why0.length ? why0.slice(0, 6) : fallbackBullets(seedText, 3);
      const bg  = bg0.length ? bg0.slice(0, 6)  : fallbackBullets(seedText, 3);
      const imp = imp0.length ? imp0.slice(0, 6) : fallbackBullets(seedText, 3);

      if (parts.join("").length < 220 && title){
        parts.push(`\n\nBu haber: “${title}”.`);
      }

      if (why.length) parts.push("\n\nNeden önemli?\n- " + why.join("\n- "));
      if (bg.length)  parts.push("\n\nArka plan\n- " + bg.join("\n- "));
      if (imp.length) parts.push("\n\nOlası etkiler\n- " + imp.join("\n- "));

      parts.push(`\n\nNot: Bu sayfada telif riskini azaltmak için haber metninin tamamı yayınlanmaz; yalnızca özgün özet ve genel çıkarımlar gösterilir. Tam içerik için “Kaynağa Git” bağlantısını kullanın. (Kaynak: ${srcLabel})`);
      return parts.join("");
    }

    // Modal
    const mBackdrop = document.getElementById("mBackdrop");
    const mClose = document.getElementById("mClose");

    function openModal(a){
      const title = safeText(a.title_tr) || safeText(a.title) || "Haber";
      const srcLabel = safeText(a.source) || classifySource(a.url || "").label || "Kaynak";
      const catKey = classifyCategory(a);
      const catLabel = CATEGORY_LABELS[catKey] || "Genel";
      const domain = getDomain(a.url || "");

      document.getElementById("mTitle").textContent = title;
      document.getElementById("mMeta").textContent = `${srcLabel} • ${catLabel} • ${domain}`;

      const longText = buildLongTR(a);
      document.getElementById("mLong").textContent = longText;

      setBullets("mWhy", a.why_important, longText);
      setBullets("mBg", a.background, longText);
      setBullets("mImp", a.possible_impacts, longText);

      const read = document.getElementById("mRead");
      const src = document.getElementById("mSource");
      read.href = a.url || "#";
      src.href = a.url || "#";

      const copyBtn = document.getElementById("mCopy");
      copyBtn.onclick = async () => {
        try{
          await navigator.clipboard.writeText(a.url || "");
          copyBtn.textContent = "Kopyalandı";
          setTimeout(()=> copyBtn.textContent="Linki Kopyala", 1200);
        }catch(_){
          copyBtn.textContent = "Kopyalanamadı";
          setTimeout(()=> copyBtn.textContent="Linki Kopyala", 1200);
        }
      };

      mBackdrop.classList.add("open");
      mBackdrop.setAttribute("aria-hidden","false");
      document.body.style.overflow = "hidden";
    }

    function closeModal(){
      mBackdrop.classList.remove("open");
      mBackdrop.setAttribute("aria-hidden","true");
      document.body.style.overflow = "";
    }

    mClose.addEventListener("click", closeModal);
    mBackdrop.addEventListener("click", (e) => { if(e.target === mBackdrop) closeModal(); });
    document.addEventListener("keydown", (e) => { if(e.key === "Escape") closeModal(); });

    async function loadNews({force=false}={}){
      const status = document.getElementById("status");
      const btn = document.getElementById("btnManualRefresh");
      try{
        if(btn) btn.classList.add("spinning");
        status.textContent = "Haberler yükleniyor...";
        const res = await fetch("./news/latest.json?t=" + (force ? Date.now() : ""), { cache:"no-store" });
        if(!res.ok){
          status.textContent = "news/latest.json yüklenemedi (HTTP " + res.status + ")";
          return;
        }
        const data = await res.json();
        ALL = Array.isArray(data.articles) ? data.articles : [];
        setStatus(ALL.length, data.generated_at || "");
        renderArticles();
      }catch(err){
        console.error(err);
        status.textContent = "Haber yüklenirken hata oluştu: " + err;
      }finally{
        if(btn) btn.classList.remove("spinning");
      }
    }

    document.addEventListener("click", function(e){
      const srcBtn = e.target.closest(".btn-filter-source");
      if(srcBtn){
        document.querySelectorAll(".btn-filter-source").forEach(b => b.classList.remove("active"));
        srcBtn.classList.add("active");
        CURRENT_SOURCE_FILTER = srcBtn.getAttribute("data-filter-source") || "all";
        renderArticles();
        return;
      }

      const catBtn = e.target.closest(".btn-filter-cat");
      if(catBtn){
        document.querySelectorAll(".btn-filter-cat").forEach(b => b.classList.remove("active"));
        catBtn.classList.add("active");
        CURRENT_CATEGORY_FILTER = catBtn.getAttribute("data-filter-cat") || "all";
        renderArticles();
        return;
      }

      const openBtn = e.target.closest("[data-open]");
      if(openBtn){
        const url = decodeURIComponent(openBtn.getAttribute("data-open") || "");
        const found = ALL.find(x => (x.url || "") === url);
        if(found) openModal(found);
        return;
      }
    });

    // Manuel yenileme
    document.getElementById("btnManualRefresh").addEventListener("click", () => loadNews({force:true}));

    // İlk yükleme
    loadNews({force:true});

    // Saatlik otomatik yenileme (sekme görünürse)
    setInterval(() => {
      if (document.visibilityState === "visible") loadNews({force:true});
    }, AUTO_REFRESH_MS);

    // Sekmeye geri gelince de yenile
    document.addEventListener("visibilitychange", () => {
      if (document.visibilityState === "visible") loadNews({force:true});
    });
  </script>
</body>
</html>
